# 文档主题合并工具使用说明

## 功能概述

这个Python脚本用于自动识别并合并docs目录下相同主题的文档，帮助整理和优化文档结构。

## 主要功能

1. **智能主题识别**: 基于文件名和内容自动识别文档主题
2. **文档重要性评估**: 智能选择最重要的文档作为主文档
3. **关键信息提取**: 从多个文档中提取并合并关键信息
4. **自动清理**: 合并完成后自动删除冗余文档
5. **格式保持**: 保持原始文档的Markdown格式
6. **错误处理**: 完整的错误处理和日志记录
7. **备份机制**: 操作前自动创建备份

## 支持的文档格式

- Markdown文件 (.md)
- 文本文件 (.txt)
- Word文档 (.docx, .doc) - 需要安装python-docx

## 安装依赖

```bash
# 安装基础依赖
pip install -r scripts/requirements.txt

# 或者手动安装可选依赖
pip install python-docx chardet
```

## 使用方法

### 基本用法

```bash
# 在项目根目录执行
python scripts/merge_docs_by_theme.py
```

### 高级用法

```bash
# 指定文档目录
python scripts/merge_docs_by_theme.py --docs-path ./docs

# 试运行模式（不实际修改文件）
python scripts/merge_docs_by_theme.py --dry-run

# 指定自定义文档目录并试运行
python scripts/merge_docs_by_theme.py --docs-path ./custom_docs --dry-run
```

## 主题分类规则

脚本会根据以下关键词自动识别文档主题：

### 预定义主题

1. **交易记录**: 交易记录、transaction、记录页面、日期筛选、查询功能
2. **资产管理**: 资产、assets、资产页面、资产数据、历史快照
3. **预算管理**: 预算、budget、预算对比、预算数据
4. **家庭协作**: 家庭协作、家庭管理、协作功能、成员管理
5. **报表统计**: 报表、统计、reports、趋势图、分析
6. **问题修复**: 修复、fix、问题、错误、bug
7. **功能优化**: 优化、optimization、改进、enhancement
8. **测试相关**: 测试、test、验证、检查
9. **数据库相关**: 数据库、database、集合、索引、云开发
10. **UI界面**: UI、界面、交互、导航、安全区
11. **技术文档**: 技术、API、接口、架构、设计
12. **兼容性**: 兼容、compatibility、适配、版本

## 文档重要性评估

脚本会根据以下因素评估文档重要性：

### 关键词权重
- 总结: 10分
- 完成: 9分
- 最终: 8分
- 方案: 7分
- 报告: 6分
- 记录: 5分
- 分析: 4分
- 计划: 3分
- 指南: 2分

### 内容评估
- 内容长度 (>5000字符: +5分, >2000字符: +3分, >500字符: +1分)
- 结构完整性 (有标题: +2分, 有二级标题: +1分, 有代码块: +1分)

## 合并规则

1. **主文档选择**: 选择重要性得分最高的文档作为主文档
2. **内容合并**: 保留主文档完整内容，其他文档提取关键信息
3. **结构优化**: 自动添加合并说明、补充信息和原始文档列表
4. **文件命名**: 合并后文档命名为 `{主题}_合并文档.md`

## 输出结果

### 合并后的文档结构

```markdown
# 主文档标题

> 📝 本文档由多个相关文档合并而成
> 🕒 合并时间: 2025-09-18 07:00:00
> 📂 原始文档数量: 3

---

## 主要内容
[主文档的完整内容]

---

## 补充信息

### 来源: 文档2.md
[提取的关键信息]

### 来源: 文档3.md
[提取的关键信息]

## 原始文档列表
1. `problems/主文档.md`
2. `problems/文档2.md`
3. `problems/文档3.md`
```

### 日志文件

- 位置: `./logs/doc_merge_YYYYMMDD_HHMMSS.log`
- 内容: 详细的操作日志和错误信息

### 总结报告

- 文件: `docs/文档合并总结报告.md`
- 内容: 合并结果统计和详细信息

## 安全机制

1. **自动备份**: 操作前自动创建完整备份到 `./docs_backup`
2. **错误恢复**: 如果出现错误，可以从备份恢复
3. **试运行模式**: 使用 `--dry-run` 参数预览操作结果
4. **详细日志**: 记录所有操作和错误信息

## 注意事项

1. **备份重要**: 虽然脚本会自动备份，但建议手动备份重要文档
2. **检查结果**: 合并完成后请检查合并结果是否符合预期
3. **路径引用**: 合并可能会影响文档间的相对路径引用
4. **编码问题**: 确保所有文档使用UTF-8编码

## 故障排除

### 常见问题

1. **编码错误**: 确保文档使用UTF-8编码
2. **权限问题**: 确保对docs目录有读写权限
3. **依赖缺失**: 安装所需的Python依赖包

### 恢复操作

如果合并结果不满意，可以从备份恢复：

```bash
# 删除当前docs目录
rm -rf ./docs

# 从备份恢复
cp -r ./docs_backup ./docs
```

## 扩展功能

脚本支持以下扩展：

1. **自定义主题**: 修改 `theme_keywords` 字典添加新主题
2. **重要性规则**: 调整 `importance_weights` 字典修改评分规则
3. **文件格式**: 添加新的文档格式支持
4. **合并策略**: 自定义文档合并逻辑

---

*最后更新: 2025-09-18*