<!--components/sync-status/sync-status.wxml-->
<view class="sync-status-container">
  <!-- 状态指示器 -->
  <view class="status-indicator {{statusClass}}" wx:if="{{showIndicator}}" bindtap="onIndicatorTap">
    <view class="indicator-icon">
      <t-icon name="{{statusIcon}}" size="32rpx" />
    </view>
    <view class="indicator-text" wx:if="{{showText}}">{{statusText}}</view>
    <t-badge count="{{conflictCount}}" wx:if="{{conflictCount > 0}}" />
  </view>

  <!-- 详细状态弹窗 -->
  <t-popup 
    visible="{{showDetails}}" 
    placement="top" 
    bind:visible-change="onDetailsVisibleChange"
    close-on-overlay-click="{{true}}"
  >
    <view class="status-details">
      <!-- 头部信息 -->
      <view class="details-header">
        <view class="header-left">
          <t-icon name="{{statusIcon}}" size="48rpx" color="{{statusColor}}" />
          <view class="header-info">
            <view class="status-title">{{statusTitle}}</view>
            <view class="status-subtitle">{{statusSubtitle}}</view>
          </view>
        </view>
        <view class="header-right">
          <t-button 
            theme="light" 
            size="small" 
            icon="close" 
            bind:tap="closeDetails"
          />
        </view>
      </view>

      <!-- 同步进度 -->
      <view class="sync-progress" wx:if="{{showProgress}}">
        <view class="progress-header">
          <text class="progress-title">同步进度</text>
          <text class="progress-text">{{progressText}}</text>
        </view>
        <t-progress 
          percentage="{{progressPercentage}}" 
          theme="{{progressTheme}}"
          stroke-width="8rpx"
          show-info="{{false}}"
        />
        <view class="progress-details">
          <text class="detail-item">已同步: {{syncedCount}}/{{totalCount}}</text>
          <text class="detail-item">剩余时间: {{estimatedTime}}</text>
        </view>
      </view>

      <!-- 网络状态 -->
      <view class="network-status">
        <view class="status-row">
          <t-icon name="wifi" size="32rpx" color="{{networkColor}}" />
          <text class="status-label">网络状态</text>
          <text class="status-value {{networkClass}}">{{networkStatus}}</text>
        </view>
        <view class="status-row">
          <t-icon name="time" size="32rpx" />
          <text class="status-label">最后同步</text>
          <text class="status-value">{{lastSyncTime}}</text>
        </view>
        <view class="status-row">
          <t-icon name="user-group" size="32rpx" />
          <text class="status-label">在线成员</text>
          <text class="status-value">{{onlineMembers}}/{{totalMembers}}</text>
        </view>
      </view>

      <!-- 冲突提醒 -->
      <view class="conflict-alerts" wx:if="{{conflicts.length > 0}}">
        <view class="alert-header">
          <t-icon name="error-circle" size="32rpx" color="#e34d59" />
          <text class="alert-title">数据冲突 ({{conflicts.length}})</text>
        </view>
        <view class="conflict-list">
          <view 
            class="conflict-item" 
            wx:for="{{conflicts}}" 
            wx:key="id"
            bindtap="onConflictTap"
            data-conflict="{{item}}"
          >
            <view class="conflict-info">
              <text class="conflict-type">{{item.typeName}}</text>
              <text class="conflict-desc">{{item.description}}</text>
            </view>
            <t-icon name="chevron-right" size="24rpx" color="#999" />
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-buttons">
        <t-button 
          theme="light" 
          size="small" 
          icon="refresh" 
          bind:tap="onManualSync"
          loading="{{syncing}}"
          disabled="{{!canSync}}"
        >
          手动同步
        </t-button>
        <t-button 
          theme="light" 
          size="small" 
          icon="setting" 
          bind:tap="onSyncSettings"
        >
          同步设置
        </t-button>
      </view>
    </view>
  </t-popup>

  <!-- 操作反馈提示 -->
  <view class="feedback-container">
    <!-- 成功提示 -->
    <view 
      class="feedback-toast success {{successVisible ? 'show' : ''}}" 
      wx:if="{{successMessage}}"
    >
      <t-icon name="check-circle" size="32rpx" />
      <text class="toast-text">{{successMessage}}</text>
    </view>

    <!-- 错误提示 -->
    <view 
      class="feedback-toast error {{errorVisible ? 'show' : ''}}" 
      wx:if="{{errorMessage}}"
    >
      <t-icon name="close-circle" size="32rpx" />
      <text class="toast-text">{{errorMessage}}</text>
    </view>

    <!-- 警告提示 -->
    <view 
      class="feedback-toast warning {{warningVisible ? 'show' : ''}}" 
      wx:if="{{warningMessage}}"
    >
      <t-icon name="error-circle" size="32rpx" />
      <text class="toast-text">{{warningMessage}}</text>
    </view>

    <!-- 信息提示 -->
    <view 
      class="feedback-toast info {{infoVisible ? 'show' : ''}}" 
      wx:if="{{infoMessage}}"
    >
      <t-icon name="info-circle" size="32rpx" />
      <text class="toast-text">{{infoMessage}}</text>
    </view>
  </view>

  <!-- 同步动画效果 -->
  <view class="sync-animation {{animationClass}}" wx:if="{{showAnimation}}">
    <view class="sync-waves">
      <view class="wave wave-1"></view>
      <view class="wave wave-2"></view>
      <view class="wave wave-3"></view>
    </view>
    <t-icon name="refresh" size="48rpx" color="#0052d9" />
  </view>

  <!-- 成员活动指示器 -->
  <view class="member-activity" wx:if="{{showMemberActivity && memberActivities.length > 0}}">
    <view class="activity-header">
      <text class="activity-title">成员动态</text>
      <t-button 
        theme="light" 
        size="mini" 
        bind:tap="toggleMemberActivity"
      >
        {{memberActivityExpanded ? '收起' : '展开'}}
      </t-button>
    </view>
    <view class="activity-list {{memberActivityExpanded ? 'expanded' : ''}}">
      <view 
        class="activity-item" 
        wx:for="{{memberActivities}}" 
        wx:key="id"
      >
        <image class="member-avatar" src="{{item.avatar}}" />
        <view class="activity-content">
          <text class="member-name">{{item.memberName}}</text>
          <text class="activity-desc">{{item.description}}</text>
          <text class="activity-time">{{item.timeDisplay}}</text>
        </view>
        <view class="activity-status {{item.statusClass}}">
          <t-icon name="{{item.statusIcon}}" size="20rpx" />
        </view>
      </view>
    </view>
  </view>

  <!-- 快速操作面板 -->
  <view class="quick-actions" wx:if="{{showQuickActions}}">
    <view class="action-item" bindtap="onQuickSync">
      <t-icon name="refresh" size="40rpx" />
      <text class="action-text">同步</text>
    </view>
    <view class="action-item" bindtap="onQuickConflictResolve" wx:if="{{conflictCount > 0}}">
      <t-icon name="error-circle" size="40rpx" />
      <text class="action-text">冲突</text>
      <t-badge count="{{conflictCount}}" />
    </view>
    <view class="action-item" bindtap="onQuickSettings">
      <t-icon name="setting" size="40rpx" />
      <text class="action-text">设置</text>
    </view>
  </view>

  <!-- 连接状态横幅 -->
  <view class="connection-banner {{connectionBannerClass}}" wx:if="{{showConnectionBanner}}">
    <view class="banner-content">
      <t-icon name="{{connectionIcon}}" size="32rpx" />
      <text class="banner-text">{{connectionMessage}}</text>
      <t-button 
        theme="light" 
        size="mini" 
        bind:tap="onRetryConnection"
        wx:if="{{showRetryButton}}"
      >
        重试
      </t-button>
    </view>
  </view>
</view>