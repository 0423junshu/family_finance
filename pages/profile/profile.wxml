<!-- pages/profile/profile.wxml -->
<view class="safe-area-wrapper safe-area-white">
  <navigation-bar title="家庭财务管理" showBack="{{false}}" class="transparent-navbar" />
</view>

<view class="page-container">

  <!-- 用户信息卡片 -->
  <view class="user-card">
    <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.svg'}}" mode="aspectFill" lazy-load="true" binderror="onAvatarError" />
    <view class="user-info">
      <text class="nickname">{{userInfo.nickName}}</text>
      <text class="phone">{{userInfo.phone || '未绑定手机号'}}</text>
    </view>
  </view>

  <!-- 家庭协作功能卡片 -->
  <view class="collaboration-section">
    <!-- 已加入家庭状态 -->
    <view class="collaboration-card" wx:if="{{isInFamily}}" bindtap="onManageFamily">
      <view class="card-header">
        <view class="card-icon">
          <text class="icon-text">👨‍👩‍👧‍👦</text>
        </view>
        <view class="card-content">
          <text class="card-title">家庭管理</text>
          <text class="card-subtitle">家庭协作</text>
        </view>
        <view class="card-status">
          <text class="status-text">{{totalMembers}}人</text>
          <text class="status-indicator {{onlineMembers > 0 ? 'online' : 'offline'}}"></text>
        </view>
      </view>
      <view class="card-body">
        <text class="card-desc">管理家庭成员、权限设置、操作日志</text>
      </view>
    </view>

    <!-- 未加入家庭状态 -->
    <view class="collaboration-invite-card" wx:if="{{!isInFamily}}" bindtap="onCreateOrJoinFamily">
      <view class="card-header">
        <view class="card-icon invite">
          <text class="icon-text">👨‍👩‍👧‍👦</text>
        </view>
        <view class="card-content">
          <text class="card-title">家庭管理</text>
          <text class="card-subtitle">开启家庭协作</text>
        </view>
        <view class="card-arrow">
          <text class="arrow-text">></text>
        </view>
      </view>
      <view class="card-body">
        <text class="card-desc">创建或加入家庭，与家人共同管理财务</text>
      </view>
    </view>
  </view>

  <!-- 功能设置列表 -->
  <view class="settings-section">
    <view 
      wx:for="{{settings}}" 
      wx:key="id"
      class="setting-item"
      data-id="{{item.id}}"
      bindtap="onSettingTap"
    >
      <view class="setting-icon">{{item.icon}}</view>
      <view class="setting-info">
        <text class="setting-title">{{item.title}}</text>
        <text class="setting-desc">{{item.desc}}</text>
      </view>
      <view class="setting-arrow">
        <text class="arrow-icon">›</text>
      </view>
    </view>
  </view>

  <!-- 其他功能 -->
  <view class="other-section">
    <view class="other-item" bindtap="onAboutTap">
      <text class="other-title">关于我们</text>
      <view class="other-arrow">
        <text class="arrow-icon">›</text>
      </view>
    </view>
    
    <view class="other-item logout" bindtap="onLogoutTap">
      <text class="other-title logout-text">退出登录</text>
    </view>
  </view>

  <!-- 版本信息 -->
  <view class="version-info">
    <text class="version-text">版本 {{version}}</text>
  </view>
</view>

<!-- 协作状态指示器 -->
<sync-status wx:if="{{collaborationEnabled}}" />