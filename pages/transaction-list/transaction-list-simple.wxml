<!-- pages/transaction-list/transaction-list-simple.wxml -->
<view class="safe-area-wrapper safe-area-white">
  <navigation-bar title="äº¤æ˜“è®°å½•" showBack="{{true}}" class="transparent-navbar" />
</view>

<view class="container">
  <!-- æ—¥æœŸé€‰æ‹© -->
  <view class="date-selector">
    <view class="date-display">
      <block wx:if="{{filters.dateRange === 'week'}}">
        æœ¬å‘¨
      </block>
      <block wx:elif="{{filters.dateRange === 'month'}}">
        <picker 
          mode="selector" 
          range="{{[2020, 2021, 2022, 2023, 2024, 2025]}}" 
          value="{{currentYear - 2020}}"
          bindchange="onYearChange"
        >
          <text class="date-text">{{currentYear}}å¹´</text>
        </picker>
        <picker 
          mode="selector" 
          range="{{[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]}}" 
          value="{{currentMonth}}"
          bindchange="onMonthChange"
        >
          <text class="date-text">{{currentMonth + 1}}æœˆ</text>
        </picker>
      </block>
      <block wx:elif="{{filters.dateRange === 'quarter'}}">
        <picker 
          mode="selector" 
          range="{{[2020, 2021, 2022, 2023, 2024, 2025]}}" 
          value="{{currentYear - 2020}}"
          bindchange="onYearChange"
        >
          <text class="date-text">{{currentYear}}å¹´</text>
        </picker>
        <text class="date-text">{{Math.floor(currentMonth / 3) + 1}}å­£åº¦</text>
      </block>
      <block wx:elif="{{filters.dateRange === 'year'}}">
        <picker 
          mode="selector" 
          range="{{[2020, 2021, 2022, 2023, 2024, 2025]}}" 
          value="{{currentYear - 2020}}"
          bindchange="onYearChange"
        >
          <text class="date-text">{{currentYear}}å¹´</text>
        </picker>
      </block>
    </view>
    
    <view class="date-range-tabs">
      <view 
        class="date-range-tab {{filters.dateRange === 'week' ? 'active' : ''}}" 
        bindtap="onDateRangeChange" 
        data-range="week"
      >
        å‘¨
      </view>
      <view 
        class="date-range-tab {{filters.dateRange === 'month' ? 'active' : ''}}" 
        bindtap="onDateRangeChange" 
        data-range="month"
      >
        æœˆ
      </view>
      <view 
        class="date-range-tab {{filters.dateRange === 'quarter' ? 'active' : ''}}" 
        bindtap="onDateRangeChange" 
        data-range="quarter"
      >
        å­£
      </view>
      <view 
        class="date-range-tab {{filters.dateRange === 'year' ? 'active' : ''}}" 
        bindtap="onDateRangeChange" 
        data-range="year"
      >
        å¹´
      </view>
    </view>
  </view>
  
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="summary-card">
    <view class="summary-item">
      <text class="summary-label">æ”¶å…¥</text>
      <text class="summary-value income">Â¥{{totalIncomeDisplay}}</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">æ”¯å‡º</text>
      <text class="summary-value expense">Â¥{{totalExpenseDisplay}}</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">ç»“ä½™</text>
      <text class="summary-value {{netAmount >= 0 ? 'income' : 'expense'}}">Â¥{{netAmountDisplay}}</text>
    </view>
  </view>
  
  <!-- ç­›é€‰å™¨ -->
  <view class="filter-bar">
    <view class="filter-tabs">
      <view 
        class="filter-tab {{filters.type === 'all' ? 'active' : ''}}" 
        bindtap="onTypeChange" 
        data-type="all"
      >
        å…¨éƒ¨
      </view>
      <view 
        class="filter-tab {{filters.type === 'expense' ? 'active' : ''}}" 
        bindtap="onTypeChange" 
        data-type="expense"
      >
        æ”¯å‡º
      </view>
      <view 
        class="filter-tab {{filters.type === 'income' ? 'active' : ''}}" 
        bindtap="onTypeChange" 
        data-type="income"
      >
        æ”¶å…¥
      </view>
    </view>
    
    <view class="filter-btn" bindtap="toggleFilterPanel">
      <text class="filter-icon">âš™ï¸</text>
      <text class="filter-text">ç­›é€‰</text>
    </view>
  </view>
  
  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <view class="filter-section">
      <text class="filter-section-title">åˆ†ç±»</text>
      <picker 
        mode="selector" 
        range="{{['å…¨éƒ¨', ...categories.map(c => c.name)]}}" 
        value="{{filters.category === 'all' ? 0 : categories.findIndex(c => c.id === filters.category) + 1}}"
        bindchange="onCategoryChange"
      >
        <view class="picker-view">
          <text class="picker-text">{{filters.category === 'all' ? 'å…¨éƒ¨' : categories.find(c => c.id === filters.category).name}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>
  
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- äº¤æ˜“åˆ—è¡¨ -->
  <view wx:elif="{{filteredTransactions.length > 0}}" class="transaction-list">
    <view 
      wx:for="{{filteredTransactions}}" 
      wx:key="id"
      class="transaction-item"
      bindtap="viewTransactionDetail"
      data-id="{{item.id}}"
    >
      <view class="transaction-icon">
        <block wx:if="{{item.type === 'income'}}">ğŸ’°</block>
        <block wx:elif="{{item.type === 'expense'}}">ğŸ’¸</block>
        <block wx:else>ğŸ”„</block>
      </view>
      
      <view class="transaction-info">
        <text class="transaction-category">{{item.category}}</text>
        <text class="transaction-date">{{item.dateDisplay}}</text>
      </view>
      
      <view class="transaction-amount {{item.type === 'income' ? 'income' : 'expense'}}">
        <text>{{item.type === 'income' ? '+' : '-'}}Â¥{{item.amountDisplay}}</text>
      </view>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-state">
    <view class="empty-icon">ğŸ“Š</view>
    <text class="empty-text">æš‚æ— äº¤æ˜“è®°å½•</text>
    <button class="add-btn" bindtap="onAddRecord">è®°ä¸€ç¬”</button>
  </view>
  
  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="onAddRecord">
    <text class="fab-icon">+</text>
  </view>
</view>