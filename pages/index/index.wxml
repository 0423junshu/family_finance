<!-- pages/index/index.wxml -->
<!-- ä½¿ç”¨é€šç”¨å®‰å…¨åŒºå®¹å™¨åŒ…è£¹å¯¼èˆªæ  -->
<view class="safe-area-wrapper safe-area-white" style="{{useJsSafeTop ? ('padding-top:' + paddingTopPx + 'px;') : ''}}">
  <navigation-bar 
    title="å®¶åº­è´¢åŠ¡ç®¡ç†" 
    show-back="{{false}}" 
    show-hide-amount="{{false}}"

    class="transparent-navbar"
  />
</view>



<view class="top-safe-inset"></view>
<view class="page-container" style="{{useJsSafeTop ? ('padding-top:' + paddingTopPx + 'px;') : ''}}">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content">
    <!-- æœˆåº¦ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-card">
      <view class="stats-header">
        <view class="month-selector" bindtap="onMonthTitleTap">
          <text class="stats-title">{{currentMonth}}æ¦‚è§ˆ</text>
          <text class="month-arrow">â–¼</text>
        </view>
        <view class="header-actions">
          <view class="sync-status">
            <text class="sync-text {{syncStatus}}" wx:if="{{syncStatus === 'syncing'}}">åŒæ­¥ä¸­...</text>
            <text class="sync-text {{syncStatus}}" wx:elif="{{syncStatus === 'success'}}">å·²åŒæ­¥</text>
            <text class="sync-text {{syncStatus}}" wx:elif="{{syncStatus === 'error'}}">åŒæ­¥å¤±è´¥</text>
          </view>
          <!-- å—æ§æ¨¡å¼ï¼šç”±æœ¬é¡µ state å†³å®šï¼Œä¸å†è·Ÿéšå…¨å±€ -->
          <eye-toggle visible="{{!hideAmount}}" bind:change="onEyeChange" />

        </view>
      </view>
      
      <view class="stats-content">
        <view class="stat-item income">
          <text class="stat-label">æ”¶å…¥</text>
          <text class="stat-value" wx:if="{{hideAmount}}">***</text>
          <text class="stat-value" wx:else>+{{incomeDisplay}}</text>
        </view>
        <view class="stat-item expense">
          <text class="stat-label">æ”¯å‡º</text>
          <text class="stat-value" wx:if="{{hideAmount}}">***</text>
          <text class="stat-value" wx:else>-{{expenseDisplay}}</text>
        </view>
        <view class="stat-item balance">
          <text class="stat-label">ç»“ä½™</text>
          <text class="stat-value {{monthlyStats.balance >= 0 ? 'positive' : 'negative'}}" wx:if="{{hideAmount}}">***</text>
          <text class="stat-value {{monthlyStats.balance >= 0 ? 'positive' : 'negative'}}" wx:else>{{balanceDisplay}}</text>
        </view>
      </view>
      
      <view class="sync-actions">
        <button 
          class="btn btn-outline btn-small"
          bindtap="onSyncTap"
          disabled="{{syncStatus === 'syncing'}}"
        >
          <text wx:if="{{syncStatus === 'syncing'}}">åŒæ­¥ä¸­...</text>
          <text wx:else>ä¸€é”®åŒæ­¥</text>
        </button>
      </view>
    </view>



    <!-- å¿«æ·æ“ä½œ -->
    <view class="quick-actions">
      <view class="action-item" bindtap="onQuickExpense">
        <view class="action-icon expense">ğŸ’¸</view>
        <text class="action-text">å¿«é€Ÿæ”¯å‡º</text>
      </view>
      <view class="action-item" bindtap="onQuickIncome">
        <view class="action-icon income">ğŸ’°</view>
        <text class="action-text">å¿«é€Ÿæ”¶å…¥</text>
      </view>
      <view class="action-item" bindtap="onQuickTransfer">
        <view class="action-icon transfer">ğŸ”„</view>
        <text class="action-text">è´¦æˆ·è½¬è´¦</text>
      </view>
      <view wx:if="{{isInFamily}}" class="action-item" bindtap="onViewOperationLogs">
        <view class="action-icon logs">ğŸ“‹</view>
        <text class="action-text">æ“ä½œæ—¥å¿—</text>
      </view>
    </view>

    <!-- äº¤æ˜“è®°å½•åˆ—è¡¨ -->
    <view class="transactions-section">
      <view class="section-header">
        <text class="section-title">æœ€è¿‘è®°å½•</text>
        <text class="section-more" bindtap="onViewAllTap">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{transactions.length === 0}}" class="empty-state">
        <view class="empty-icon">ğŸ“</view>
        <text class="empty-text">æš‚æ— è®°å½•</text>
        <text class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®°è´¦</text>
      </view>
      
      <!-- äº¤æ˜“åˆ—è¡¨ -->
      <view wx:else class="transactions-list">
        <view 
          wx:for="{{transactions}}" 
          wx:key="id"
          class="transaction-item card-item"
          data-item="{{item}}"
          data-id="{{item.id}}"
          bindtap="onTransactionTap"
          bindlongpress="onTransactionLongPress"
        >
          <view class="transaction-icon">
            <text class="category-emoji">{{item.categoryIcon}}</text>
          </view>
          <view class="transaction-info">
            <text class="transaction-desc">{{item.description || item.categoryName}}</text>
            <view class="transaction-meta">
              <text class="transaction-date">{{item.dateDisplay}}</text>
            </view>
          </view>
          <view class="transaction-amount">
            <text class="amount {{item.type}}" wx:if="{{hideAmount}}">***</text>
            <text class="amount {{item.type}}" wx:elif="{{item.type === 'income'}}">+{{item.amountDisplay}}</text>
            <text class="amount {{item.type}}" wx:else>-{{item.amountDisplay}}</text>
            <text class="account-name">{{item.accountName}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è®°è´¦æµ®åŠ¨æŒ‰é’® -->
  <view class="fab" bindtap="onRecordTap">
    <text class="fab-icon">+</text>
  </view>

  <!-- æ–°è´¦å•æç¤º -->
  <view wx:if="{{newTransactionCount > 0}}" class="new-transaction-tip" bindtap="onNewTransactionTap">
    <text class="tip-text">æ–°å¢ {{newTransactionCount}} æ¡è®°å½•</text>
    <text class="tip-close" catchtap="onCloseTip">Ã—</text>
  </view>

  <!-- æœˆä»½é€‰æ‹©å™¨ -->
  <view wx:if="{{showMonthPicker}}" class="month-picker-overlay" bindtap="onMonthPickerCancel">
    <view class="month-picker-container" catchtap="noop">
      <view class="month-picker-header">
        <text class="picker-title">é€‰æ‹©æœˆä»½</text>
        <text class="picker-cancel" bindtap="onMonthPickerCancel">å–æ¶ˆ</text>
      </view>
      <picker-view 
        class="month-picker-view"
        indicator-style="height: 50px;"
        value="{{monthPickerIndex}}"
        bindchange="onMonthPickerChange"
      >
        <picker-view-column>
          <view wx:for="{{monthPickerData[0]}}" wx:key="*this" class="picker-item">{{item}}</view>
        </picker-view-column>
        <picker-view-column>
          <view wx:for="{{monthPickerData[1]}}" wx:key="*this" class="picker-item">{{item}}</view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>
</view>
