<!--pages/join-family/join-family.wxml-->
<navigation-bar title="хКахЕехо╢х║н" showBack="{{true}}" />

<view class="page-container">
  <!-- хКахЕецЦ╣х╝ПщАЙцЛй -->
  <view wx:if="{{currentStep === 'select'}}" class="step-container">
    <view class="welcome-section">
      <view class="welcome-icon">ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж</view>
      <text class="welcome-title">хКахЕехо╢х║нш┤вхКбчобчРЖ</text>
      <text class="welcome-desc">щАЙцЛйхКахЕецЦ╣х╝Пя╝Мх╝АхзЛф╕Охо╢ф║║хЕ▒хРМчобчРЖш┤вхКб</text>
    </view>

    <view class="join-methods">
      <view class="method-card" bind:tap="selectMethod" data-method="code">
        <view class="method-icon">ЁЯФв</view>
        <view class="method-content">
          <text class="method-title">ш╛УхЕехо╢х║нчаБ</text>
          <text class="method-desc">ш╛УхЕе6ф╜Нхо╢х║нчаБх┐лщАЯхКахЕе</text>
        </view>
        <view class="method-arrow">тЖТ</view>
      </view>

      <view class="method-card" bind:tap="selectMethod" data-method="scan">
        <view class="method-icon">ЁЯУ▒</view>
        <view class="method-content">
          <text class="method-title">цЙлцППф║Мч╗┤чаБ</text>
          <text class="method-desc">цЙлцППхо╢х║нщВАшп╖ф║Мч╗┤чаБ</text>
        </view>
        <view class="method-arrow">тЖТ</view>
      </view>

      <view class="method-card" bind:tap="selectMethod" data-method="link">
        <view class="method-icon">ЁЯФЧ</view>
        <view class="method-content">
          <text class="method-title">щАЪш┐ЗщВАшп╖щУ╛цОе</text>
          <text class="method-desc">чВ╣хЗ╗щВАшп╖щУ╛цОечЫ┤цОехКахЕе</text>
        </view>
        <view class="method-arrow">тЖТ</view>
      </view>
    </view>

    <view class="create-option">
      <text class="create-text">ш┐Шц▓бцЬЙхо╢х║ня╝Я</text>
      <text class="create-link" bind:tap="createFamily">хИЫх╗║цЦ░хо╢х║н</text>
    </view>
  </view>

  <!-- ш╛УхЕехо╢х║нчаБ -->
  <view wx:if="{{currentStep === 'input'}}" class="step-container">
    <view class="input-section">
      <view class="input-header">
        <text class="input-title">ш╛УхЕехо╢х║нчаБ</text>
        <text class="input-desc">шп╖ш╛УхЕе6ф╜Нхо╢х║нчаБ</text>
      </view>

      <view class="family-code-input">
        <t-input
          value="{{familyCode}}"
          placeholder="шп╖ш╛УхЕехо╢х║нчаБ"
          maxlength="6"
          bind:change="onFamilyCodeChange"
          bind:enter="joinFamily"
          focus="{{true}}"
          class="code-input"
        />
      </view>

      <view class="input-tips">
        <text class="tip-text">тАв хо╢х║нчаБчФ▒6ф╜НхнЧцпНхТМцХ░хнЧч╗ДцИР</text>
        <text class="tip-text">тАв шп╖хРСхо╢х║нчобчРЖхСШшО╖хПЦхо╢х║нчаБ</text>
      </view>
    </view>

    <view class="action-buttons">
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="joinFamily"
        disabled="{{familyCode.length !== 6}}"
        loading="{{joining}}"
      >
        {{joining ? 'хКахЕеф╕н...' : 'хКахЕехо╢х║н'}}
      </t-button>
      
      <t-button 
        theme="light" 
        size="large" 
        bind:tap="goBack"
        class="back-btn"
      >
        ш┐ФхЫЮ
      </t-button>
    </view>
  </view>

  <!-- цЙлцППф║Мч╗┤чаБ -->
  <view wx:if="{{currentStep === 'scan'}}" class="step-container">
    <view class="scan-section">
      <view class="scan-header">
        <text class="scan-title">цЙлцППф║Мч╗┤чаБ</text>
        <text class="scan-desc">х░Жф║Мч╗┤чаБцФ╛хЕецбЖхЖЕш┐ЫшбМцЙлцПП</text>
      </view>

      <view class="scan-area">
        <camera 
          device-position="back" 
          flash="off" 
          bind:scancode="onScanCode"
          class="camera"
        />
        <view class="scan-frame"></view>
      </view>

      <view class="scan-tips">
        <text class="tip-text">тАв шп╖хп╣хЗЖхо╢х║нщВАшп╖ф║Мч╗┤чаБ</text>
        <text class="tip-text">тАв чбоф┐ЭхЕЙч║┐хЕЕш╢│я╝Мф║Мч╗┤чаБц╕ЕцЩ░</text>
      </view>
    </view>

    <view class="action-buttons">
      <t-button 
        theme="light" 
        size="large" 
        bind:tap="goBack"
      >
        ш┐ФхЫЮ
      </t-button>
    </view>
  </view>

  <!-- хКахЕеч╗УцЮЬ -->
  <view wx:if="{{currentStep === 'result'}}" class="step-container">
    <t-result
      theme="{{joinResult.success ? 'success' : 'error'}}"
      title="{{joinResult.title}}"
      description="{{joinResult.description}}"
    >
      <view slot="extra" class="result-actions">
        <t-button 
          wx:if="{{joinResult.success}}" 
          theme="primary" 
          size="large" 
          bind:tap="goToFamily"
        >
          ш┐ЫхЕехо╢х║нчобчРЖ
        </t-button>
        
        <t-button 
          wx:else 
          theme="primary" 
          size="large" 
          bind:tap="retry"
        >
          щЗНцЦ░х░ЭшпХ
        </t-button>
        
        <t-button 
          theme="light" 
          size="large" 
          bind:tap="goHome"
          class="secondary-btn"
        >
          ш┐ФхЫЮщжЦщб╡
        </t-button>
      </view>
    </t-result>
  </view>

  <!-- хКаш╜╜чК╢цАБ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <t-loading theme="circular" size="large" text="{{loadingText}}" />
  </view>
</view>

<!-- Toast цПРчд║ -->
<t-toast id="t-toast" />