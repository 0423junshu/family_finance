<!-- pages/category-manage/category-manage.wxml -->
<view class="safe-area-wrapper safe-area-white">
  <navigation-bar title="分类管理" showBack="{{true}}" class="transparent-navbar" />
</view>

<view class="page-container">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
  
  <view wx:else class="content">
    <!-- 分类类型切换 -->
    <view class="type-tabs">
      <view class="tab {{activeType === 'expense' ? 'active' : ''}}" data-type="expense" bindtap="onTypeChange">支出</view>
      <view class="tab {{activeType === 'income' ? 'active' : ''}}" data-type="income" bindtap="onTypeChange">收入</view>
      <view class="tab {{activeType === 'transfer' ? 'active' : ''}}" data-type="transfer" bindtap="onTypeChange">转账</view>
    </view>
    
    <!-- 分类列表 -->
    <view class="category-list">
      <block wx:for="{{categories}}" wx:key="_id">
        <view wx:if="{{item.type === activeType}}" class="category-item">
          <view class="category-info" data-category="{{item}}" bindtap="showEditDialog">
            <view class="category-icon" style="background-color: {{item.color}}">
              <text>{{item.icon}}</text>
            </view>
            <text class="category-name">{{item.name}}</text>
            <text wx:if="{{item.isDefault}}" class="category-badge">默认</text>
            <text wx:if="{{item.isCustom}}" class="category-badge custom">自定义</text>
          </view>
          
          <view class="category-actions">
            <view wx:if="{{!item.isDefault}}" class="action-btn delete" catchtap="onDeleteCategory" data-category="{{item}}">
              <text class="action-icon">🗑️</text>
            </view>
          </view>
        </view>
      </block>
      
      <!-- 添加分类按钮 -->
      <view class="add-category" bindtap="showAddDialog">
        <view class="add-icon">+</view>
        <text class="add-text">添加分类</text>
      </view>
    </view>
  </view>
  
  <!-- 新增/编辑分类对话框 -->
  <view wx:if="{{showDialog}}" class="dialog-overlay" catchtap="closeDialog">
    <view class="dialog-container" catchtap="noop">
      <view class="dialog-header">
        <text class="dialog-title">{{dialogMode === 'create' ? '新增分类' : '编辑分类'}}</text>
        <view class="dialog-close" catchtap="closeDialog">×</view>
      </view>
      
      <view class="dialog-content">
        <!-- 名称输入 -->
        <view class="form-group">
          <text class="form-label">名称</text>
          <input class="form-input {{errors.name ? 'error' : ''}}" value="{{formData.name}}" placeholder="请输入分类名称" maxlength="10" bindinput="onNameInput" />
          <text wx:if="{{errors.name}}" class="error-text">{{errors.name}}</text>
        </view>
        
        <!-- 图标选择 -->
        <view class="form-group">
          <text class="form-label">图标</text>
          <view class="icon-preview" style="background-color: {{formData.color}}">
            <text>{{formData.icon}}</text>
          </view>
          <scroll-view class="icon-selector" scroll-y="true">
            <view class="icon-grid">
              <view 
                wx:for="{{availableIcons}}" 
                wx:key="*this"
                class="icon-item {{formData.icon === item ? 'selected' : ''}}"
                data-icon="{{item}}"
                bindtap="onIconSelect"
              >
                <text>{{item}}</text>
              </view>
            </view>
          </scroll-view>
        </view>
        
        <!-- 颜色选择 -->
        <view class="form-group">
          <text class="form-label">颜色</text>
          <view class="color-selector">
            <view 
              wx:for="{{availableColors}}" 
              wx:key="*this"
              class="color-item {{formData.color === item ? 'selected' : ''}}"
              style="background-color: {{item}}"
              data-color="{{item}}"
              bindtap="onColorSelect"
            ></view>
          </view>
        </view>
      </view>
      
      <view class="dialog-actions">
        <button class="btn btn-cancel" catchtap="closeDialog">取消</button>
        <button class="btn btn-confirm" catchtap="saveCategory">保存</button>
      </view>
    </view>
  </view>
</view>