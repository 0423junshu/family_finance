<!-- pages/stats/stats.wxml -->
<view class="safe-area-wrapper safe-area-white">
  <navigation-bar title="报表统计" show-back="{{false}}" class="transparent-navbar" />
</view>

<view class="page-container">
  <!-- 时间范围选择 -->
  <view class="date-range-tabs">
    <view 
      class="range-tab {{dateRange === 'week' ? 'active' : ''}}"
      data-range="week"
      bindtap="onDateRangeChange"
    >
      本周
    </view>
    <view 
      class="range-tab {{dateRange === 'month' ? 'active' : ''}}"
      data-range="month"
      bindtap="onDateRangeChange"
    >
      本月
    </view>
    <view 
      class="range-tab {{dateRange === 'year' ? 'active' : ''}}"
      data-range="year"
      bindtap="onDateRangeChange"
    >
      本年
    </view>
  </view>

  <!-- 统计概览 -->
  <view class="summary-header" style="display:flex;align-items:center;justify-content:space-between;padding: 8rpx 12rpx 0;">
    <text class="summary-title">统计概览</text>
    <eye-toggle visible="{{pageMoneyVisible}}" bind:change="onEyeChange" />
  </view>
  <view class="summary-card">
    <view class="summary-item">
      <text class="summary-label">总收入</text>
      <text class="summary-value income" wx:if="{{pageMoneyVisible}}">+{{summary.totalIncomeDisplay}}</text>
      <text class="summary-value income" wx:else>***</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">总支出</text>
      <text class="summary-value expense" wx:if="{{pageMoneyVisible}}">-{{summary.totalExpenseDisplay}}</text>
      <text class="summary-value expense" wx:else>***</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">结余</text>
      <text class="summary-value {{summary.balance >= 0 ? 'income' : 'expense'}}" wx:if="{{pageMoneyVisible}}">
        <block wx:if="{{summary.balance >= 0}}">+</block>{{summary.balanceDisplay}}
      </text>
      <text class="summary-value {{summary.balance >= 0 ? 'income' : 'expense'}}" wx:else>***</text>
    </view>
  </view>

  <!-- 分类统计 -->
  <view class="category-stats">
    <view class="section-title">支出分类</view>
    <view class="category-list">
      <view 
        wx:for="{{categoryStats}}" 
        wx:key="name"
        class="category-item"
      >
        <view class="category-info">
          <text class="category-name">{{item.name}}</text>
          <text class="category-amount" wx:if="{{pageMoneyVisible}}">{{item.amountDisplay}}</text>
          <text class="category-amount" wx:else>***</text>
        </view>
        <view class="category-bar">
          <view 
            class="category-progress" 
            style="width: {{item.progressWidth}}%"
          ></view>
        </view>
      </view>
    </view>
  </view>
</view>