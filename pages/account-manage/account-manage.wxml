<!-- pages/account-manage/account-manage.wxml -->
<navigation-bar title="{{mode === 'create' ? '新增账户' : '编辑账户'}}" showBack="{{true}}" />

<view class="page-container">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
  
  <view wx:else class="content">
    <!-- 账户表单 -->
    <view class="form-container">
      <!-- 账户图标预览 -->
      <view class="icon-preview">
        <view class="icon-display" bindtap="showIconPicker">
          <text class="account-icon">{{formData.icon}}</text>
          <text class="icon-tip">点击更换图标</text>
        </view>
      </view>

      <!-- 账户名称 -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">账户名称</text>
          <text class="required">*</text>
        </view>
        <view class="form-input">
          <input 
            class="input {{errors.name ? 'error' : ''}}"
            placeholder="请输入账户名称"
            value="{{formData.name}}"
            bindinput="onNameInput"
            maxlength="20"
          />
        </view>
      </view>
      <view wx:if="{{errors.name}}" class="error-text">{{errors.name}}</view>

      <!-- 账户类型 -->
      <view class="form-item" bindtap="showTypePicker">
        <view class="form-label">
          <text class="label-text">账户类型</text>
          <text class="required">*</text>
        </view>
        <view class="form-value">
          <view class="type-display">
            <text class="type-icon">{{formData.icon}}</text>
            <text class="type-name">{{currentTypeName}}</text>
          </view>
          <image class="arrow-icon" src="/images/icons/arrow-right.png" />
        </view>
      </view>
      <view wx:if="{{errors.type}}" class="error-text">{{errors.type}}</view>

      <!-- 初始余额 -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">{{mode === 'create' ? '初始余额' : '当前余额'}}</text>
          <text class="required">*</text>
        </view>
        <view class="form-input">
          <view class="amount-input-container">
            <text class="currency-symbol">¥</text>
            <input 
              class="amount-input {{errors.balance ? 'error' : ''}}"
              type="digit"
              placeholder="0.00"
              value="{{formData.balance}}"
              bindinput="onBalanceInput"
              bindblur="onBalanceBlur"
              confirm-type="done"
            />
          </view>
        </view>
      </view>
      <view wx:if="{{errors.balance}}" class="error-text">{{errors.balance}}</view>

      <!-- 账户描述 -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">账户描述</text>
        </view>
        <view class="form-input">
          <textarea 
            class="textarea"
            placeholder="添加账户描述（可选）"
            value="{{formData.description}}"
            bindinput="onDescriptionInput"
            maxlength="100"
            auto-height
          />
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-container">
      <button 
        class="btn btn-primary btn-large {{submitting ? 'btn-disabled' : ''}}"
        bindtap="onSubmit"
        disabled="{{submitting}}"
      >
        <text wx:if="{{submitting}}">{{mode === 'create' ? '创建中...' : '保存中...'}}</text>
        <text wx:else>{{mode === 'create' ? '创建账户' : '保存修改'}}</text>
      </button>
      
      <button 
        wx:if="{{mode === 'edit'}}"
        class="btn btn-danger btn-large"
        bindtap="onDelete"
      >
        删除账户
      </button>
    </view>
  </view>

  <!-- 账户类型选择器 -->
  <view wx:if="{{showTypePicker}}" class="picker-overlay" bindtap="onPickerClose">
    <view class="picker-container" catchtap="">
      <view class="picker-header">
        <text class="picker-title">选择账户类型</text>
        <view class="picker-close" bindtap="onPickerClose">
          <image class="close-icon" src="/images/icons/close.png" />
        </view>
      </view>
      <view class="picker-content">
        <view 
          wx:for="{{accountTypes}}" 
          wx:key="value"
          class="picker-item {{item.value === formData.type ? 'selected' : ''}}"
          data-type="{{item.value}}"
          bindtap="onTypeSelect"
        >
          <view class="type-info">
            <text class="type-icon">{{item.icon}}</text>
            <text class="type-name">{{item.label}}</text>
          </view>
          <image wx:if="{{item.value === formData.type}}" class="check-icon" src="/images/icons/check.png" />
        </view>
      </view>
    </view>
  </view>

  <!-- 图标选择器 -->
  <view wx:if="{{showIconPicker}}" class="picker-overlay" bindtap="onPickerClose">
    <view class="picker-container" catchtap="">
      <view class="picker-header">
        <text class="picker-title">选择账户图标</text>
        <view class="picker-close" bindtap="onPickerClose">
          <image class="close-icon" src="/images/icons/close.png" />
        </view>
      </view>
      <view class="picker-content">
        <view class="icon-grid">
          <view 
            wx:for="{{iconOptions}}" 
            wx:key="*this"
            class="icon-item {{item === formData.icon ? 'selected' : ''}}"
            data-icon="{{item}}"
            bindtap="onIconSelect"
          >
            <text class="icon-emoji">{{item}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>