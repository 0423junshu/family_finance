<!-- pages/transfer/transfer.wxml -->
<navigation-bar title="è´¦æˆ·è½¬è´¦" showBack="{{true}}" />

<view class="page-container">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ï¿½?..</text>
  </view>
  
  <view wx:else class="content">
    <!-- è½¬è´¦è¡¨å• -->
    <view class="form-container">
      <!-- é‡‘é¢è¾“å…¥ -->
      <view class="form-section">
        <view class="section-title">è½¬è´¦é‡‘é¢</view>
        <view class="amount-input-container">
          <text class="currency-symbol">Â¥</text>
          <input 
            class="amount-input {{errors.amount ? 'error' : ''}}"
            type="digit"
            placeholder="0.00"
            value="{{formData.amount}}"
            bindinput="onAmountInput"
            bindblur="onAmountBlur"
            confirm-type="done"
            cursor-spacing="50"
          />
        </view>
        <view wx:if="{{errors.amount}}" class="error-text">{{errors.amount}}</view>
      </view>

      <!-- è½¬å‡ºè´¦æˆ· -->
      <view class="form-item" bindtap="onFromAccountTap">
        <view class="form-label">
          <text class="form-icon">ğŸ“¤</text>
          <text>è½¬å‡ºè´¦æˆ·</text>
        </view>
        <view class="form-value">
          <view wx:if="{{fromAccount}}" class="account-info">
            <text class="account-name">{{fromAccount.name}}</text>
            <text class="account-balance">ä½™é¢: {{fromAccount.balanceDisplay}}</text>
          </view>
          <text wx:else class="placeholder-text">è¯·é€‰æ‹©è½¬å‡ºè´¦æˆ·</text>
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
      <view wx:if="{{errors.fromAccountId}}" class="error-text">{{errors.fromAccountId}}</view>

      <!-- è½¬è´¦ç®­å¤´ -->
      <view class="transfer-arrow">
        <text class="arrow-down-icon">â¬‡ï¸</text>
      </view>

      <!-- è½¬å…¥è´¦æˆ· -->
      <view class="form-item" bindtap="onToAccountTap">
        <view class="form-label">
          <text class="form-icon">ğŸ“¥</text>
          <text>è½¬å…¥è´¦æˆ·</text>
        </view>
        <view class="form-value">
          <view wx:if="{{toAccount}}" class="account-info">
            <text class="account-name">{{toAccount.name}}</text>
            <text class="account-balance">ä½™é¢: {{toAccount.balanceDisplay}}</text>
          </view>
          <text wx:else class="placeholder-text">è¯·é€‰æ‹©è½¬å…¥è´¦æˆ·</text>
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
      <view wx:if="{{errors.toAccountId}}" class="error-text">{{errors.toAccountId}}</view>

      <!-- æ—¥æœŸé€‰æ‹© -->
      <view class="form-item">
        <view class="form-label">
          <text class="form-icon">ğŸ“…</text>
          <text>è½¬è´¦æ—¥æœŸ</text>
        </view>
        <view class="form-value">
          <picker mode="date" value="{{formData.date}}" bindchange="onDateChange">
            <text class="selected-text">{{formData.date}}</text>
          </picker>
        </view>
      </view>

      <!-- å¤‡æ³¨è¾“å…¥ -->
      <view class="form-item">
        <view class="form-label">
          <text class="form-icon">ğŸ“</text>
          <text>å¤‡æ³¨</text>
        </view>
        <view class="form-value">
          <input 
            class="note-input"
            placeholder="æ·»åŠ è½¬è´¦å¤‡æ³¨"
            value="{{formData.description}}"
            bindinput="onDescriptionInput"
            maxlength="100"
          />
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-container">
      <button 
        class="btn btn-primary btn-large {{submitting ? 'btn-disabled' : ''}}"
        bindtap="onSubmit"
        disabled="{{submitting}}"
      >
        <text wx:if="{{submitting}}">è½¬è´¦ï¿½?..</text>
        <text wx:else>ç¡®è®¤è½¬è´¦</text>
      </button>
    </view>
  </view>

  <!-- è½¬å‡ºè´¦æˆ·é€‰æ‹©ï¿½?-->
  <view wx:if="{{showFromAccountPicker}}" class="picker-overlay" bindtap="onPickerClose">
    <view class="picker-container" catchtap="">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©è½¬å‡ºè´¦æˆ·</text>
        <view class="picker-close" bindtap="onPickerClose">
          <text class="close-icon">âœ•</text>
        </view>
      </view>
      <view class="picker-content">
        <view 
          wx:for="{{accounts}}" 
          wx:key="_id"
          class="picker-item {{item._id === formData.fromAccountId ? 'selected' : ''}}"
          data-id="{{item._id}}"
          bindtap="onFromAccountSelect"
        >
          <view class="account-info">
            <text class="account-name">{{item.name}}</text>
            <text class="account-balance">ä½™é¢: {{item.balanceDisplay}}</text>
          </view>
          <text wx:if="{{item._id === formData.fromAccountId}}" class="check-icon">âœ“</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è½¬å…¥è´¦æˆ·é€‰æ‹©ï¿½?-->
  <view wx:if="{{showToAccountPicker}}" class="picker-overlay" bindtap="onPickerClose">
    <view class="picker-container" catchtap="">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©è½¬å…¥è´¦æˆ·</text>
        <view class="picker-close" bindtap="onPickerClose">
          <text class="close-icon">âœ•</text>
        </view>
      </view>
      <view class="picker-content">
        <view 
          wx:for="{{accounts}}" 
          wx:key="_id"
          wx:if="{{item._id !== formData.fromAccountId}}"
          class="picker-item {{item._id === formData.toAccountId ? 'selected' : ''}}"
          data-id="{{item._id}}"
          bindtap="onToAccountSelect"
        >
          <view class="account-info">
            <text class="account-name">{{item.name}}</text>
            <text class="account-balance">ä½™é¢: {{item.balanceDisplay}}</text>
          </view>
          <text wx:if="{{item._id === formData.toAccountId}}" class="check-icon">âœ“</text>
        </view>
      </view>
    </view>
  </view>
</view>
