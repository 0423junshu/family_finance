# 报表页数据为0与资产卡片跳转问题排查与修复

## Core Features

- 资产卡片点击事件与跳转校验

- 报表服务零数据桩冲突修复

- 资产详情参数传递增强

- tabBar 页面上下文一致性修复（onLoad/onShow/initData/calculateTotalAssets 全链路）

- long 构建错误依赖定位与规避策略

- 收入支出TOP5分类跳转月份与筛选条件修复

- wx:key对象数组警告彻底修复

- 分类ID唯一性保证与重复键值彻底消除

- 分类ID命名规范优化与业务含义增强

- 资产页面账户图标优化与投资数据同步增强

- 理财主题UI一致性设计与收益率精确格式化

- 账户图标数据迁移机制与强制更新策略

- 投资理财页面图标逻辑统一与分类标准规范化

- 跨页面投资图标一致性实现与数据迁移完善

- 投资添加页面类型选择框前端界面实现

- 投资页面分类筛选逻辑完善与债券类型支持

- 投资页面动态分类标签显示优化

## Tech Stack

{
  "MiniProgram": {
    "framework": "WeChat Mini Program",
    "ui": "tdesign-miniprogram"
  }
}

## Design

最小改动，强制在所有数据入口优先应用跳转上下文，保证月份一致性；修正分类筛选从ID改为名称匹配；彻底解决wx:key对象数组警告；确保分类ID绝对唯一且具有业务含义；优化资产页面图标设计与投资数据同步；理财主题UI一致性设计，收益率精确到小数点后两位；实现数据迁移机制强制更新存储中的旧图标和格式；统一投资理财图标逻辑，建立产品级别和类型级别的双层图标映射机制；实现跨页面投资图标完全一致，余额宝统一显示💎；为投资添加页面增加投资类型选择框，确保用户能够在前端界面中看到并选择不同的投资类型；完善投资页面分类筛选逻辑，支持债券、数字货币、其他等全部6种投资类型的正确分类显示；实现动态投资分类标签显示，根据用户实际持有的投资类型动态生成标签，'全部'始终显示，其他标签仅在有对应投资时显示；不改UI布局。

## Plan

Note: 

- [ ] is holding
- [/] is doing
- [X] is done

---

[X] 语法与运行时错误：对report.js进行lint/编译，控制台查看是否有报错；回退对比最近改动定位潜在early return或未定义变量

[X] 数据源入参核对：打印请求参数（时间范围、分类、分页、自定义周期）并与之前版本或reports-simple.js对齐

[X] 云函数返回校验：在调用处打印原始返回，云开发控制台查看getTransactions、manageCategory实际返回与期望字段是否一致

[X] 数据处理函数验证：对聚合/映射函数进行单元打印，使用小样本mock输入，逐步检查是否出现NaN/undefined触发默认0

[X] 字段映射与路径：确认从API到state的字段名、层级未变（如data.list→transactions），避免空数组导致全0

[X] 渲染层检查：核对tdesign图表/组件绑定的数据字段、格式与维度（xAxis、series、legend）是否匹配期望

[X] 交互状态影响：检查筛选器、周期选择、趋势开关的默认值与watcher是否把过滤条件设为全空

[X] 回滚验证与差异对比：用reports-simple.js或上一个正常版本替换对比，最小化变更定位根因并修正

[X] 资产卡片跳转事件绑定修复：修复goToAssetsPage函数调用和switchTab跳转逻辑，解决tabBar页面参数传递问题

[X] 收入支出TOP5点击响应修复：为viewCategoryDetail函数增加调试日志，确保事件正确触发和参数传递

[X] 资产页面上下文处理优化：修复重复函数定义，完善onShow和checkReportsContext逻辑，确保月份一致性

[X] profile.json组件路径修复：修正tdesign-miniprogram组件路径，解决热重载阻塞问题

[X] assets.js语法错误修复：清理重复代码块，通过语法检查，确保文件可正常编译运行

[X] long模块ES2019语法兼容性修复：将catch{}改为catch(e){}，解决微信小程序不支持可选catch绑定的问题

[X] tdesign组件依赖临时移除：从profile.json移除tdesign组件引用，避免构建npm阻塞，确保核心功能可测试

[X] 收入支出TOP5跳转月份修正：将0-based月份转换为1-based传递给交易列表页面，确保月份显示正确

[X] 分类筛选条件优化：从传递分类ID改为传递分类名称，确保交易记录筛选能正确匹配数据

[X] URL编码乱码问题修复：移除encodeURIComponent编码，避免中文分类名称在交易列表页面显示为乱码

[X] wx:key重复警告彻底修复：使用wx:key='*this'和不同索引名称，彻底解决分类ID重复导致的键值冲突问题

[X] wx:key对象数组[object Object]警告修复：将分类数据改用wx:key='id'，年月列表改用wx:key='*this'，彻底解决对象数组键值显示问题

[X] 分类ID唯一性生成修复：使用时间戳+随机数生成绝对唯一的分类ID，彻底消除income_2等重复键值警告

[X] 分类ID命名规范优化：使用分类名称hash值生成具有业务含义的唯一ID，确保相同分类名称始终对应相同ID，提升数据一致性

[X] 资产页面账户图标本地化优化：将现金💵→💴、招商银行🏛️→🏦、支付宝💳→🟦，提升本地化视觉体验

[X] 投资理财默认数据图标同步：余额宝💰→💎与测试数据保持一致，确保理财主题UI统一性

[X] 理财主题UI一致性完善：getInvestmentIcon和getAccountIcon函数已完善，所有图标符合理财主题设计规范

[X] 投资收益率精确格式化验证：确认所有收益率数值精确到小数点后两位显示，数据同步和格式化过程一致性已验证

[X] 账户图标数据迁移机制实现：添加migrateAccountIcons函数，强制更新存储中的旧图标数据，确保新图标在所有历史月份生效

[X] 投资收益率格式迁移增强：在图标迁移过程中同时修正投资收益率格式，确保所有数据精确到小数点后两位

[X] 投资理财图标逻辑分析：详细分析资产页面getInvestmentIcon与投资页面getTypeIcon的差异，明确余额宝💎vs💰不一致的根本原因

[X] 投资分类标准规范化：明确fund/bank/stock三大类的业务含义、数据模型字段、前端选择器配置，建立完整的分类体系

[X] 图标统一优化方案设计：提出产品级别（余额宝→💎）和类型级别（fund→📈）的双层图标映射机制，解决跨页面图标不一致问题

[X] 投资理财页面图标逻辑统一实现：修改investment-add.js的getTypeIcon函数，增加产品级别映射，确保余额宝显示💎

[X] 投资页面图标同步机制完善：在investments.js中添加getUnifiedInvestmentIcon函数，确保数据加载时图标统一更新

[X] 投资默认数据图标修正：将余额宝💰→💎、股票投资→腾讯控股📊，与资产页面保持完全一致

[X] 投资图标数据迁移机制实现：添加migrateInvestmentIcons函数，自动更新存储中的旧投资图标数据，确保跨页面一致性

[X] 投资类型选择框前端界面实现：在investment-add.wxml中添加投资类型选择项，修复用户无法看到和选择投资类型的问题

[X] 投资页面分类筛选逻辑修复：完善typeMap映射，支持债券、数字货币、其他等全部6种投资类型，确保每种类型都能在对应分类标签下正确显示

[X] 投资页面动态分类标签显示实现：根据用户实际持有的投资类型动态生成标签，'全部'始终显示，其他标签仅在有对应投资时显示，提升界面简洁性和个性化体验

[X] 项目整体功能验证与最终测试：确认所有报表页面、资产卡片跳转、投资理财功能正常工作，用户体验流畅一致
