# 云开发数据库索引建议与空查询审计

结论：
- 业务代码未发现 `where({})` 空条件的全表扫描；仅在依赖包测试代码中出现。
- 建议为高频查询集合建立联合索引，降低扫描量、提升分页与统计性能。

建议索引（按优先级）：
1. transactions
   - { familyId: 1, date: -1 }
   - { userId: 1, date: -1 }
   - 如有按账户维度：{ accountId: 1, date: -1 }
2. accounts
   - { userId: 1 }
   - { familyId: 1 }
3. family_members
   - { userId: 1, familyId: 1 }（去重/校验成员时）

代码侧建议：
- 统一按“范围 + 排序”模式构建条件，如：
  - date: _.gte(startDate).and(_.lte(endDate))
  - 必要时补充 familyId / userId 过滤，避免跨家庭数据扫描。
- 分页查询时，同步使用 count() 获取 total（仅 page === 1 执行）。

运维与验证：
- 在云开发控制台为上述集合添加索引；
- 使用云函数中典型查询（getTransactions）进行对比压测。