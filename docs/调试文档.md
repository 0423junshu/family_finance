# è°ƒè¯•æ–‡æ¡£

## WXMLç¼–è¯‘é”™è¯¯é—®é¢˜è®°å½•

### é—®é¢˜æè¿°
åœ¨å¾®ä¿¡å°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†å¤šä¸ªWXMLç¼–è¯‘é”™è¯¯ï¼Œä¸»è¦æ˜¯ç”±äºåœ¨WXMLæ¨¡æ¿ä¸­ä½¿ç”¨äº†ä¸æ”¯æŒçš„JavaScriptæ–¹æ³•ã€‚

### é”™è¯¯ç±»å‹
**é”™è¯¯ä¿¡æ¯æ ¼å¼**: `Bad value with message: unexpected '>' at pos[æ•°å­—]`

### å…·ä½“é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. Navigation-barç»„ä»¶å±æ€§é”™è¯¯
**é—®é¢˜**: ä½¿ç”¨äº†é”™è¯¯çš„å±æ€§å `show-back`
**é”™è¯¯ä»£ç **:
```xml
<navigation-bar title="é¡µé¢æ ‡é¢˜" show-back="{{true}}" />
```
**è§£å†³æ–¹æ¡ˆ**: ä¿®æ”¹ä¸ºæ­£ç¡®çš„å±æ€§å `showBack`
```xml
<navigation-bar title="é¡µé¢æ ‡é¢˜" showBack="{{true}}" />
```
**å½±å“é¡µé¢**: 
- pages/account-manage/account-manage.wxml
- pages/transfer/transfer.wxml  
- pages/transaction-list/transaction-list.wxml
- pages/investment-add/investment-add.wxml
- pages/cycle-edit/cycle-edit.wxml

#### 2. WXMLä¸­ä½¿ç”¨JavaScript findæ–¹æ³•
**é—®é¢˜**: åœ¨WXMLæ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨JavaScriptçš„findæ–¹æ³•
**é”™è¯¯ä»£ç **:
```xml
<text>{{accountTypes.find(t => t.value === formData.type).label}}</text>
<text>{{investmentTypes.find(t => t.value === formData.type).icon}}</text>
<text>{{cycleTypes.find(t => t.value === formData.type).icon}}</text>
<text>{{weekDays.find(d => d.value === formData.day).label}}</text>
```

**è§£å†³æ–¹æ¡ˆ**: åœ¨JavaScriptä¸­é¢„è®¡ç®—æ•°æ®ï¼ŒWXMLåªè´Ÿè´£æ˜¾ç¤º
```xml
<!-- WXMLä¸­ä½¿ç”¨è®¡ç®—å¥½çš„å±æ€§ -->
<text>{{currentTypeName}}</text>
<text>{{currentTypeIcon}}</text>
<text>{{currentDayName}}</text>
```

```javascript
// JavaScriptä¸­æ·»åŠ è®¡ç®—æ–¹æ³•
updateCurrentTypeName() {
  const currentType = this.data.accountTypes.find(t => t.value === this.data.formData.type)
  const currentDay = this.data.weekDays.find(d => d.value === this.data.formData.day)
  
  this.setData({
    currentTypeName: currentType ? currentType.label : 'é»˜è®¤å€¼',
    currentTypeIcon: currentType ? currentType.icon : 'é»˜è®¤å›¾æ ‡',
    currentDayName: currentDay ? currentDay.label : 'å‘¨æ—¥'
  })
}
```

**å½±å“é¡µé¢**:
- pages/account-manage/account-manage.wxml - è´¦æˆ·ç±»å‹æ˜¾ç¤º
- pages/investment-add/investment-add.wxml - æŠ•èµ„ç±»å‹æ˜¾ç¤ºå’Œå›¾æ ‡
- pages/cycle-edit/cycle-edit.wxml - å‘¨æœŸç±»å‹å’Œæ˜ŸæœŸæ˜¾ç¤º

#### 3. WXMLä¸­ä½¿ç”¨å¤æ‚JavaScriptè¡¨è¾¾å¼è®¡ç®—
**é—®é¢˜**: åœ¨WXMLæ¨¡æ¿ä¸­ä½¿ç”¨å¤æ‚çš„JavaScriptè¡¨è¾¾å¼è¿›è¡Œæ•°å­¦è®¡ç®—
**é”™è¯¯ä»£ç **:
```xml
<!-- å¤æ‚çš„æ”¶ç›Šè®¡ç®—è¡¨è¾¾å¼ -->
<text class="profit-value {{(parseFloat(formData.amount) - parseFloat(formData.cost)) >= 0 ? 'positive' : 'negative'}}">
  {{(parseFloat(formData.amount) - parseFloat(formData.cost)) >= 0 ? '+' : ''}}{{(parseFloat(formData.amount) - parseFloat(formData.cost)).toFixed(2)}}
</text>
<text class="profit-value {{(parseFloat(formData.amount) - parseFloat(formData.cost)) >= 0 ? 'positive' : 'negative'}}">
  {{(parseFloat(formData.amount) - parseFloat(formData.cost)) >= 0 ? '+' : ''}}{{(((parseFloat(formData.amount) - parseFloat(formData.cost)) / parseFloat(formData.cost)) * 100).toFixed(2)}}%
</text>
```

**è§£å†³æ–¹æ¡ˆ**: åœ¨JavaScriptä¸­é¢„è®¡ç®—å¤æ‚æ•°æ®ï¼ŒWXMLä½¿ç”¨ç®€å•ç»‘å®š
```xml
<!-- WXMLä¸­ä½¿ç”¨é¢„è®¡ç®—çš„æ•°æ® -->
<view wx:if="{{showProfitDisplay}}" class="profit-display">
  <view class="profit-item">
    <text class="profit-label">æ”¶ç›Šé‡‘é¢</text>
    <text class="profit-value {{profitData.isPositive ? 'positive' : 'negative'}}">
      {{profitData.profitAmountText}}
    </text>
  </view>
  <view class="profit-item">
    <text class="profit-label">æ”¶ç›Šç‡</text>
    <text class="profit-value {{profitData.isPositive ? 'positive' : 'negative'}}">
      {{profitData.profitRateText}}
    </text>
  </view>
</view>
```

```javascript
// JavaScriptä¸­æ·»åŠ è®¡ç®—æ–¹æ³•
calculateProfit() {
  const amount = parseFloat(this.data.formData.amount) || 0
  const cost = parseFloat(this.data.formData.cost) || 0
  
  if (amount > 0 && cost > 0) {
    const profitAmount = amount - cost
    const profitRate = (profitAmount / cost) * 100
    const isPositive = profitAmount >= 0
    
    this.setData({
      showProfitDisplay: true,
      profitData: {
        isPositive: isPositive,
        profitAmountText: `${isPositive ? '+' : ''}${profitAmount.toFixed(2)}`,
        profitRateText: `${isPositive ? '+' : ''}${profitRate.toFixed(2)}%`
      }
    })
  } else {
    this.setData({
      showProfitDisplay: false
    })
  }
}

// åœ¨è¾“å…¥äº‹ä»¶ä¸­è°ƒç”¨è®¡ç®—
onAmountInput(e) {
  // ... å…¶ä»–é€»è¾‘
  this.calculateProfit()
}
```

**å½±å“é¡µé¢**:
- pages/investment-add/investment-add.wxml - æŠ•èµ„æ”¶ç›Šè®¡ç®—æ˜¾ç¤º

#### 4. WXMLä¸­ä½¿ç”¨ä¸æ”¯æŒçš„äº‹ä»¶ç»‘å®šè¯­æ³•
**é—®é¢˜**: åœ¨pickerç»„ä»¶çš„bindcancelå±æ€§ä¸­ä½¿ç”¨äº†ç®­å¤´å‡½æ•°
**é”™è¯¯ä»£ç **:
```xml
<picker 
  bindcancel="{{() => setData({showDatePicker: false})}}"
>
</picker>
```

**è§£å†³æ–¹æ¡ˆ**: åœ¨JavaScriptä¸­å®šä¹‰æ–¹æ³•ï¼ŒWXMLä¸­å¼•ç”¨æ–¹æ³•å
```xml
<!-- WXMLä¸­ä½¿ç”¨æ–¹æ³•å -->
<picker 
  bindcancel="onDatePickerCancel"
>
</picker>
```

```javascript
// JavaScriptä¸­å®šä¹‰å¯¹åº”æ–¹æ³•
onDatePickerCancel() {
  this.setData({
    showDatePicker: false
  })
}
```

**å½±å“é¡µé¢**:
- pages/transaction-list/transaction-list.wxml - æ—¥æœŸé€‰æ‹©å™¨å–æ¶ˆäº‹ä»¶

### ä¿®å¤æ­¥éª¤æ€»ç»“

1. **æ£€æŸ¥WXMLè¯­æ³•**: ç¡®ä¿æ‰€æœ‰ç»„ä»¶å±æ€§åç§°æ­£ç¡®
2. **ç§»é™¤å¤æ‚è¡¨è¾¾å¼**: å°†JavaScripté€»è¾‘ä»WXMLç§»åˆ°JSæ–‡ä»¶
3. **æ·»åŠ è®¡ç®—å±æ€§**: åœ¨JSä¸­é¢„è®¡ç®—éœ€è¦æ˜¾ç¤ºçš„æ•°æ®
4. **æ›´æ–°æ—¶æœº**: åœ¨æ•°æ®å˜åŒ–æ—¶åŠæ—¶è°ƒç”¨æ›´æ–°æ–¹æ³•

### æœ€ä½³å®è·µ

#### WXMLç¼–å†™è§„èŒƒ
- ä½¿ç”¨æ­£ç¡®çš„ç»„ä»¶å±æ€§åç§°
- é¿å…åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¤æ‚çš„JavaScriptè¡¨è¾¾å¼
- ä¼˜å…ˆä½¿ç”¨ç®€å•çš„æ•°æ®ç»‘å®š
- å¤æ‚é€»è¾‘åœ¨JSä¸­å¤„ç†ï¼ŒWXMLåªè´Ÿè´£å±•ç¤º

#### æ•°æ®ç»‘å®šä¼˜åŒ–
```javascript
// å¥½çš„åšæ³•ï¼šé¢„è®¡ç®—æ•°æ®
data: {
  currentTypeName: 'ç°é‡‘',
  currentTypeIcon: 'ğŸ’°'
}

// åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–°
onTypeChange() {
  this.updateDisplayData()
}
```

```xml
<!-- å¥½çš„åšæ³•ï¼šç®€å•ç»‘å®š -->
<text>{{currentTypeName}}</text>

<!-- é¿å…çš„åšæ³•ï¼šå¤æ‚è¡¨è¾¾å¼ -->
<text>{{types.find(t => t.id === currentId).name}}</text>
```

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹ç¼–è¯‘é”™è¯¯ä½ç½®**: æ ¹æ®é”™è¯¯ä¿¡æ¯ä¸­çš„ä½ç½®å®šä½å…·ä½“é—®é¢˜
2. **é€æ­¥æ’æŸ¥**: æ³¨é‡Šæ‰å¯ç–‘ä»£ç æ®µï¼Œé€æ­¥å®šä½é—®é¢˜
3. **ä½¿ç”¨å¼€å‘è€…å·¥å…·**: åˆ©ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„è°ƒè¯•åŠŸèƒ½
4. **ä»£ç å®¡æŸ¥**: å®šæœŸæ£€æŸ¥WXMLä¸­æ˜¯å¦æœ‰ä¸è§„èŒƒçš„å†™æ³•

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‡å°‘è®¡ç®—é¢‘ç‡**: åªåœ¨å¿…è¦æ—¶æ›´æ–°è®¡ç®—å±æ€§
2. **ç¼“å­˜è®¡ç®—ç»“æœ**: é¿å…é‡å¤è®¡ç®—ç›¸åŒæ•°æ®
3. **åˆå¹¶æ›´æ–°**: æ‰¹é‡æ›´æ–°ç›¸å…³çš„æ˜¾ç¤ºæ•°æ®

```javascript
// ä¼˜åŒ–ç¤ºä¾‹ï¼šæ‰¹é‡æ›´æ–°
updateAllDisplayData() {
  const updates = {}
  
  // è®¡ç®—æ‰€æœ‰éœ€è¦æ›´æ–°çš„æ•°æ®
  const currentType = this.data.types.find(t => t.value === this.data.formData.type)
  if (currentType) {
    updates.currentTypeName = currentType.label
    updates.currentTypeIcon = currentType.icon
  }
  
  // ä¸€æ¬¡æ€§æ›´æ–°
  this.setData(updates)
}
```

## å…¶ä»–è°ƒè¯•è®°å½•

### é¡µé¢è·¯ç”±é—®é¢˜
- ç¡®ä¿æ‰€æœ‰æ–°å¢é¡µé¢éƒ½åœ¨app.jsonä¸­æ­£ç¡®é…ç½®
- æ£€æŸ¥é¡µé¢è·¯å¾„æ˜¯å¦æ­£ç¡®

### æ•°æ®åŒæ­¥é—®é¢˜  
- ä½¿ç”¨wx.getStorageSyncå’Œwx.setStorageSyncè¿›è¡Œæœ¬åœ°æ•°æ®ç®¡ç†
- åœ¨é¡µé¢é—´ä¼ é€’æ•°æ®æ—¶æ³¨æ„æ•°æ®æ ¼å¼çš„ä¸€è‡´æ€§

### ç»„ä»¶å¼•ç”¨é—®é¢˜
- ç¡®ä¿è‡ªå®šä¹‰ç»„ä»¶åœ¨ä½¿ç”¨é¡µé¢çš„jsonæ–‡ä»¶ä¸­æ­£ç¡®å£°æ˜
- æ£€æŸ¥ç»„ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

---
*æœ€åæ›´æ–°æ—¶é—´: 2025-08-23 23:37*