# 云开发集合初始化清单（家庭管理与冲突/日志模块）

说明：为避免使用过程中出现 “errCode: -502005 database collection not exists”，请在云开发控制台（环境与小程序一致）手动创建下列集合与常用索引。仅需初始化一次。

建议命名保持与代码一致，字段初期不强校验，可按需新增。

1) operation_logs
- 用途：操作日志记录与统计
- 建议索引：
  - createdAt: 时间索引（倒序查询）
  - userId: 哈希索引
  - level: 哈希索引（info/warning/error/critical）
  - operationType: 哈希索引
- 示例字段：
  - operationId: string
  - operationType: string
  - level: string
  - userId: string
  - createdAt: date
  - details: object

2) data_conflicts
- 用途：数据冲突记录
- 建议索引：
  - conflictId: 哈希索引（唯一）
  - status: 哈希索引（pending/resolved）
  - involvedUsers: 数组索引（如需）
  - createdAt: 时间索引
- 示例字段：
  - conflictId: string
  - collection: string
  - documentId: string
  - involvedUsers: string[]
  - status: string
  - createdAt: date
  - resolvedAt: date|null
  - resolutionStrategy: string|null
  - resolution: object|null

3) data_locks
- 用途：并发编辑锁
- 建议索引：
  - lockId: 哈希索引（唯一）
  - userId: 哈希索引
  - status: 哈希索引（active/released/expired）
  - expiresAt: 时间索引
- 示例字段：
  - lockId: string
  - collection: string
  - documentId: string
  - userId: string
  - status: string
  - createdAt: date
  - expiresAt: date
  - heartbeat: date

4) data_versions
- 用途：版本历史管理
- 建议索引：
  - collection+documentId 组合索引
  - version: 数字索引（倒序查询最新）
  - modifiedBy: 哈希索引
  - modifiedAt: 时间索引
- 示例字段：
  - collection: string
  - documentId: string
  - version: number
  - data: object
  - operation: string
  - modifiedBy: string
  - modifiedAt: date
  - checksum: string

执行步骤（控制台）：
1. 进入云开发 -> 数据库 -> 新建集合，依次创建上述集合
2. 在每个集合的“索引管理”中添加建议索引（如组合索引：collection_documentId）
3. 无需导入数据，集合存在后，前端会正常工作；统计空态也能正常显示

备注：
- 我们已在代码中为集合缺失做了静默降级处理，不会阻断流程；但为了完整功能（日志记录、冲突检测与解决），仍建议按上述步骤创建集合。