# é¢„ç®—å¯¹æ¯”åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆå¯¹æ¯”åˆ†æž

## çŽ°æœ‰åŠŸèƒ½æž¶æž„åˆ†æž

### å½“å‰æŠ¥è¡¨ç³»ç»Ÿç»“æž„
```
pages/reports/reports-simple.js
â”œâ”€â”€ æ”¶æ”¯æ¦‚è§ˆ (currentTab: 0)
â”‚   â”œâ”€â”€ æ”¶æ”¯æ±‡æ€»å¡ç‰‡
â”‚   â”œâ”€â”€ æ”¯å‡ºåˆ†ç±»TOP5
â”‚   â””â”€â”€ æ”¶å…¥åˆ†ç±»TOP5
â”œâ”€â”€ åˆ†ç±»ç»Ÿè®¡ (currentTab: 1)
â”‚   â”œâ”€â”€ æ”¯å‡º/æ”¶å…¥åˆ‡æ¢
â”‚   â””â”€â”€ å®Œæ•´åˆ†ç±»åˆ—è¡¨
â”œâ”€â”€ è¶‹åŠ¿å›¾ (currentTab: 2, éžæœˆåº¦)
â”œâ”€â”€ èµ„äº§åˆ†æž (currentTab: 3, éžæœˆåº¦)
â””â”€â”€ æ ‡ç­¾åˆ†æž (currentTab: 4)
```

### çŽ°æœ‰ç»Ÿè®¡å‘¨æœŸæ”¯æŒ
- **æŒ‰æœˆç»Ÿè®¡** (`dateRange: 'month'`): æ”¯æŒæ—¥çº§åˆ«è¶‹åŠ¿ï¼Œç¦ç”¨è¶‹åŠ¿å›¾å’Œèµ„äº§åˆ†æž
- **æŒ‰å¹´ç»Ÿè®¡** (`dateRange: 'year'`): æ”¯æŒæœˆçº§åˆ«è¶‹åŠ¿ï¼Œå¯ç”¨æ‰€æœ‰æ ‡ç­¾é¡µ
- **è‡ªå®šä¹‰å‘¨æœŸ** (`dateRange: 'custom'`): æ”¯æŒæœˆçº§åˆ«è¶‹åŠ¿ï¼Œå¯ç”¨æ‰€æœ‰æ ‡ç­¾é¡µ

## æ–¹æ¡ˆå¯¹æ¯”åˆ†æž

### æ–¹æ¡ˆä¸€ï¼šç‹¬ç«‹æ–°å¢žæ¨¡å—

#### 1.1 è®¾è®¡æ–¹æ¡ˆ
```javascript
// æ–°å¢žç¬¬6ä¸ªæ ‡ç­¾é¡µ
const tabs = [
  { index: 0, name: 'æ”¶æ”¯æ¦‚è§ˆ' },
  { index: 1, name: 'åˆ†ç±»ç»Ÿè®¡' },
  { index: 2, name: 'è¶‹åŠ¿å›¾' },
  { index: 3, name: 'èµ„äº§åˆ†æž' },
  { index: 4, name: 'æ ‡ç­¾åˆ†æž' },
  { index: 5, name: 'é¢„ç®—å¯¹æ¯”' } // æ–°å¢ž
];
```

#### 1.2 ä¼˜ç‚¹
âœ… **åŠŸèƒ½ç‹¬ç«‹æ€§å¼º**ï¼šä¸å½±å“çŽ°æœ‰åˆ†ç±»ç»Ÿè®¡é€»è¾‘  
âœ… **å¼€å‘é£Žé™©ä½Ž**ï¼šæ–°å¢žä»£ç ï¼Œä¸ä¿®æ”¹çŽ°æœ‰åŠŸèƒ½  
âœ… **æµ‹è¯•ç®€å•**ï¼šç‹¬ç«‹æµ‹è¯•ï¼Œä¸å½±å“çŽ°æœ‰åŠŸèƒ½ç¨³å®šæ€§  
âœ… **æ‰©å±•æ€§å¥½**ï¼šå¯ä»¥ç‹¬ç«‹æ·»åŠ æ›´å¤šé¢„ç®—åˆ†æžåŠŸèƒ½  

#### 1.3 ç¼ºç‚¹
âŒ **åŠŸèƒ½å†—ä½™**ï¼šä¸Žåˆ†ç±»ç»Ÿè®¡å­˜åœ¨æ•°æ®é‡å¤å±•ç¤º  
âŒ **ç”¨æˆ·ä½“éªŒå‰²è£‚**ï¼šç”¨æˆ·éœ€è¦åœ¨ä¸¤ä¸ªæ ‡ç­¾é¡µé—´åˆ‡æ¢æŸ¥çœ‹ç›¸å…³ä¿¡æ¯  
âŒ **ç»´æŠ¤æˆæœ¬é«˜**ï¼šéœ€è¦ç»´æŠ¤ä¸¤å¥—ç›¸ä¼¼çš„åˆ†ç±»å±•ç¤ºé€»è¾‘  
âŒ **ç•Œé¢å¤æ‚åŒ–**ï¼šæ ‡ç­¾é¡µå¢žå¤šï¼Œç§»åŠ¨ç«¯æ˜¾ç¤ºæ‹¥æŒ¤  

#### 1.4 å†—ä½™åˆ†æž
```
åˆ†ç±»ç»Ÿè®¡é¡µé¢æ˜¾ç¤ºï¼š
- é¤é¥®: Â¥1,200 (25%)
- äº¤é€š: Â¥800 (17%)

é¢„ç®—å¯¹æ¯”é¡µé¢æ˜¾ç¤ºï¼š
- é¤é¥®: é¢„ç®—Â¥1,500 â†’ å®žé™…Â¥1,200 (80%)
- äº¤é€š: é¢„ç®—Â¥1,000 â†’ å®žé™…Â¥800 (80%)
```
**ç»“è®ºï¼šå­˜åœ¨æ˜Žæ˜¾çš„æ•°æ®é‡å¤å±•ç¤ºé—®é¢˜**

### æ–¹æ¡ˆäºŒï¼šçŽ°æœ‰åŠŸèƒ½å¢žå¼º

#### 2.1 è®¾è®¡æ–¹æ¡ˆ
åœ¨çŽ°æœ‰åˆ†ç±»ç»Ÿè®¡é¡µé¢ä¸­å¢žåŠ é¢„ç®—å¯¹æ¯”æ¨¡å¼åˆ‡æ¢ï¼š

```javascript
// åœ¨åˆ†ç±»ç»Ÿè®¡é¡µé¢å¢žåŠ æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢
data: {
  categoryDisplayMode: 'amount', // 'amount' | 'budget'
  // amount: æ˜¾ç¤ºé‡‘é¢å’Œå æ¯”ï¼ˆçŽ°æœ‰æ¨¡å¼ï¼‰
  // budget: æ˜¾ç¤ºé¢„ç®—å¯¹æ¯”
}
```

#### 2.2 ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†ç±»ç»Ÿè®¡                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ”¯å‡º] [æ”¶å…¥]    [é‡‘é¢æ¨¡å¼] [é¢„ç®—æ¨¡å¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é‡‘é¢æ¨¡å¼ï¼ˆçŽ°æœ‰ï¼‰ï¼š                    â”‚
â”‚ ðŸ½ï¸ é¤é¥®    Â¥1,200  25%             â”‚
â”‚ ðŸš— äº¤é€š    Â¥800   17%              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¢„ç®—æ¨¡å¼ï¼ˆæ–°å¢žï¼‰ï¼š                    â”‚
â”‚ ðŸ½ï¸ é¤é¥®                            â”‚
â”‚ é¢„ç®—Â¥1,500 â†’ å®žé™…Â¥1,200 (èŠ‚çº¦Â¥300) â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 80%               â”‚
â”‚                                     â”‚
â”‚ ðŸš— äº¤é€š                            â”‚
â”‚ é¢„ç®—Â¥1,000 â†’ å®žé™…Â¥800 (èŠ‚çº¦Â¥200)   â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 80%               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3 ä¼˜ç‚¹
âœ… **é¿å…åŠŸèƒ½å†—ä½™**ï¼šåœ¨åŒä¸€é¡µé¢å±•ç¤ºç›¸å…³ä¿¡æ¯  
âœ… **ç”¨æˆ·ä½“éªŒç»Ÿä¸€**ï¼šä¸€ä¸ªé¡µé¢å†…å®Œæˆæ‰€æœ‰åˆ†ç±»ç›¸å…³æŸ¥çœ‹  
âœ… **ç»´æŠ¤æˆæœ¬ä½Ž**ï¼šå¤ç”¨çŽ°æœ‰åˆ†ç±»æ•°æ®å’Œç­›é€‰é€»è¾‘  
âœ… **ç•Œé¢ç®€æ´**ï¼šä¸å¢žåŠ æ–°æ ‡ç­¾é¡µï¼Œä¿æŒç•Œé¢æ¸…çˆ½  
âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼šåŒä¸€æ•°æ®æºï¼Œé¿å…ä¸ä¸€è‡´é—®é¢˜  

#### 2.4 ç¼ºç‚¹
âŒ **å¼€å‘å¤æ‚åº¦é«˜**ï¼šéœ€è¦é‡æž„çŽ°æœ‰åˆ†ç±»ç»Ÿè®¡é€»è¾‘  
âŒ **æµ‹è¯•é£Žé™©**ï¼šå¯èƒ½å½±å“çŽ°æœ‰åˆ†ç±»ç»Ÿè®¡åŠŸèƒ½  
âŒ **ç•Œé¢å¤æ‚**ï¼šå•é¡µé¢åŠŸèƒ½å¢žå¤šï¼Œå¯èƒ½æ˜¾å¾—æ‹¥æŒ¤  

## ç»Ÿè®¡å‘¨æœŸè¯¦ç»†è®¾è®¡

### 3.1 æŒ‰æœˆç»Ÿè®¡ (dateRange: 'month')

#### 3.1.1 æ•°æ®å±•ç¤ºæ–¹å¼
```javascript
// æœˆåº¦é¢„ç®—å¯¹æ¯”æ•°æ®ç»“æž„
const monthlyBudgetData = {
  period: '2025å¹´9æœˆ',
  expense: {
    budgeted: 5000,    // å½“æœˆæ€»é¢„ç®—
    actual: 4200,      // å½“æœˆå®žé™…æ”¯å‡º
    difference: 800,   // å·®é¢
    percentage: 84,    // æ‰§è¡ŒçŽ‡
    status: 'under'    // çŠ¶æ€ï¼šunder/over/equal
  },
  categories: [
    {
      categoryId: 'expense_1',
      categoryName: 'é¤é¥®',
      budgeted: 1500,
      actual: 1200,
      dailyAverage: 40,      // æ—¥å‡æ”¯å‡º
      remainingDays: 15,     // å‰©ä½™å¤©æ•°
      projectedTotal: 1240,  // é¢„è®¡æœˆæœ«æ€»é¢
      difference: 300,
      percentage: 80,
      status: 'under'
    }
  ]
};
```

#### 3.1.2 äº¤äº’é€»è¾‘
- **æœˆä»½åˆ‡æ¢**ï¼šå¤ç”¨çŽ°æœ‰æœˆä»½é€‰æ‹©å™¨
- **é¢„ç®—è¿›åº¦**ï¼šæ˜¾ç¤ºå½“æœˆå·²è¿‡å¤©æ•°çš„é¢„ç®—æ‰§è¡Œæƒ…å†µ
- **é¢„æµ‹åŠŸèƒ½**ï¼šåŸºäºŽå½“å‰æ”¯å‡ºé€Ÿåº¦é¢„æµ‹æœˆæœ«æ€»é¢
- **é¢„è­¦æç¤º**ï¼šè¶…æ”¯é£Žé™©æé†’

### 3.2 æŒ‰å¹´ç»Ÿè®¡ (dateRange: 'year')

#### 3.2.1 æ•°æ®å±•ç¤ºæ–¹å¼
```javascript
// å¹´åº¦é¢„ç®—å¯¹æ¯”æ•°æ®ç»“æž„
const yearlyBudgetData = {
  period: '2025å¹´',
  expense: {
    budgeted: 60000,   // å¹´åº¦æ€»é¢„ç®—
    actual: 45000,     // å¹´åº¦å®žé™…æ”¯å‡º
    difference: 15000,
    percentage: 75,
    monthlyAverage: 3750, // æœˆå‡æ”¯å‡º
    trend: 'decreasing'   // è¶‹åŠ¿ï¼šincreasing/decreasing/stable
  },
  monthlyBreakdown: [
    {
      month: '2025-01',
      budgeted: 5000,
      actual: 4200,
      percentage: 84
    }
    // ... å…¶ä»–æœˆä»½
  ],
  categories: [
    {
      categoryId: 'expense_1',
      categoryName: 'é¤é¥®',
      budgeted: 18000,      // å¹´åº¦é¢„ç®—
      actual: 13500,       // å¹´åº¦å®žé™…
      monthlyData: [       // æœˆåº¦æ˜Žç»†
        { month: '2025-01', budgeted: 1500, actual: 1200 },
        { month: '2025-02', budgeted: 1500, actual: 1100 }
      ],
      trend: 'stable'
    }
  ]
};
```

#### 3.2.2 äº¤äº’é€»è¾‘
- **å¹´ä»½åˆ‡æ¢**ï¼šå¤ç”¨çŽ°æœ‰å¹´ä»½é€‰æ‹©å™¨
- **æœˆåº¦é’»å–**ï¼šç‚¹å‡»æœˆä»½å¯æŸ¥çœ‹è¯¥æœˆè¯¦ç»†å¯¹æ¯”
- **è¶‹åŠ¿åˆ†æž**ï¼šæ˜¾ç¤ºå„åˆ†ç±»çš„å¹´åº¦è¶‹åŠ¿å˜åŒ–
- **å­£åº¦æ±‡æ€»**ï¼šæä¾›å­£åº¦ç»´åº¦çš„é¢„ç®—æ‰§è¡Œåˆ†æž

### 3.3 è‡ªå®šä¹‰å‘¨æœŸ (dateRange: 'custom')

#### 3.3.1 æ•°æ®å±•ç¤ºæ–¹å¼
```javascript
// è‡ªå®šä¹‰å‘¨æœŸé¢„ç®—å¯¹æ¯”æ•°æ®ç»“æž„
const customBudgetData = {
  period: '2025-06-01 è‡³ 2025-08-31',
  totalDays: 92,
  expense: {
    budgeted: 15000,      // å‘¨æœŸæ€»é¢„ç®—ï¼ˆæŒ‰æœˆé¢„ç®—è®¡ç®—ï¼‰
    actual: 12600,       // å‘¨æœŸå®žé™…æ”¯å‡º
    dailyAverage: 137,   // æ—¥å‡æ”¯å‡º
    difference: 2400,
    percentage: 84
  },
  monthlyBreakdown: [
    {
      month: '2025-06',
      days: 30,
      budgeted: 5000,
      actual: 4200
    },
    {
      month: '2025-07', 
      days: 31,
      budgeted: 5000,
      actual: 4100
    },
    {
      month: '2025-08',
      days: 31,
      budgeted: 5000,
      actual: 4300
    }
  ]
};
```

#### 3.3.2 äº¤äº’é€»è¾‘
- **æ—¥æœŸèŒƒå›´é€‰æ‹©**ï¼šå¤ç”¨çŽ°æœ‰è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨
- **è·¨æœˆåˆ†æž**ï¼šè‡ªåŠ¨è®¡ç®—è·¨æœˆæœŸé—´çš„é¢„ç®—åˆ†é…
- **æ—¥å‡å¯¹æ¯”**ï¼šæ˜¾ç¤ºæ—¥å‡é¢„ç®—vsæ—¥å‡å®žé™…çš„å¯¹æ¯”
- **å‘¨æœŸè°ƒæ•´**ï¼šæ”¯æŒå¿«é€Ÿé€‰æ‹©å¸¸ç”¨å‘¨æœŸï¼ˆå­£åº¦ã€åŠå¹´ç­‰ï¼‰

## æŽ¨èæ–¹æ¡ˆ

### æœ€ç»ˆæŽ¨èï¼šæ–¹æ¡ˆäºŒï¼ˆçŽ°æœ‰åŠŸèƒ½å¢žå¼ºï¼‰

#### ç†ç”±åˆ†æž
1. **é¿å…åŠŸèƒ½å†—ä½™**ï¼šé¢„ç®—å¯¹æ¯”æœ¬è´¨ä¸Šæ˜¯åˆ†ç±»ç»Ÿè®¡çš„å¦ä¸€ç§å±•ç¤ºæ–¹å¼
2. **ç”¨æˆ·ä½“éªŒæ›´ä½³**ï¼šç”¨æˆ·åœ¨ä¸€ä¸ªé¡µé¢å†…å°±èƒ½çœ‹åˆ°åˆ†ç±»çš„é‡‘é¢ç»Ÿè®¡å’Œé¢„ç®—å¯¹æ¯”
3. **ç³»ç»Ÿæž¶æž„ç®€æ´**ï¼šä¸å¢žåŠ æ–°çš„æ ‡ç­¾é¡µï¼Œä¿æŒçŽ°æœ‰æž¶æž„çš„ç®€æ´æ€§
4. **å¼€å‘æ•ˆçŽ‡é«˜**ï¼šå¤ç”¨çŽ°æœ‰çš„åˆ†ç±»æ•°æ®èŽ·å–å’Œç­›é€‰é€»è¾‘

#### å®žæ–½ç­–ç•¥
```javascript
// åˆ†é˜¶æ®µå®žæ–½
Phase 1: åœ¨åˆ†ç±»ç»Ÿè®¡é¡µé¢å¢žåŠ æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢
Phase 2: å®žçŽ°é¢„ç®—å¯¹æ¯”æ•°æ®è®¡ç®—é€»è¾‘  
Phase 3: ä¼˜åŒ–é¢„ç®—å¯¹æ¯”çš„å¯è§†åŒ–å±•ç¤º
Phase 4: å¢žåŠ é¢„ç®—é¢„è­¦å’Œè¶‹åŠ¿åˆ†æžåŠŸèƒ½
```

## æŠ€æœ¯å®žçŽ°æ–¹æ¡ˆ

### 4.1 æ•°æ®èŽ·å–ä¼˜åŒ–
```javascript
// ç»Ÿä¸€çš„æ•°æ®èŽ·å–å‡½æ•°
async function getCategoryStatsWithBudget(params) {
  const [categoryStats, budgetData] = await Promise.all([
    getCategoryStats(params),
    getBudgetData(params)
  ]);
  
  return mergeCategoryAndBudgetData(categoryStats, budgetData);
}
```

### 4.2 æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢
```javascript
// åœ¨åˆ†ç±»ç»Ÿè®¡é¡µé¢å¢žåŠ æ¨¡å¼åˆ‡æ¢
data: {
  categoryDisplayMode: 'amount', // 'amount' | 'budget'
},

onDisplayModeChange(e) {
  const mode = e.currentTarget.dataset.mode;
  this.setData({ categoryDisplayMode: mode });
}
```

### 4.3 é¢„ç®—æ•°æ®è®¡ç®—
```javascript
function calculateBudgetComparison(categoryStats, budgetData, dateRange) {
  return categoryStats.map(category => {
    const budget = budgetData.find(b => b.categoryId === category.id);
    if (!budget) return { ...category, hasBudget: false };
    
    const budgetAmount = calculatePeriodBudget(budget, dateRange);
    const difference = budgetAmount - category.amount;
    const percentage = budgetAmount > 0 ? Math.round((category.amount / budgetAmount) * 100) : 0;
    
    return {
      ...category,
      hasBudget: true,
      budgeted: budgetAmount,
      difference,
      percentage,
      status: category.amount > budgetAmount ? 'over' : 
              category.amount < budgetAmount ? 'under' : 'equal'
    };
  });
}
```

## æ€»ç»“

é€šè¿‡è¯¦ç»†çš„æ–¹æ¡ˆå¯¹æ¯”åˆ†æžï¼Œ**æ–¹æ¡ˆäºŒï¼ˆçŽ°æœ‰åŠŸèƒ½å¢žå¼ºï¼‰**åœ¨é¿å…åŠŸèƒ½å†—ä½™ã€æå‡ç”¨æˆ·ä½“éªŒã€ä¿æŒç³»ç»Ÿæž¶æž„ç®€æ´æ€§æ–¹é¢å…·æœ‰æ˜Žæ˜¾ä¼˜åŠ¿ã€‚è™½ç„¶å¼€å‘å¤æ‚åº¦ç¨é«˜ï¼Œä½†é€šè¿‡åˆç†çš„åˆ†é˜¶æ®µå®žæ–½ç­–ç•¥ï¼Œå¯ä»¥æœ‰æ•ˆæŽ§åˆ¶é£Žé™©ï¼Œæœ€ç»ˆå®žçŽ°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç”¨æˆ·ä½“éªŒè‰¯å¥½çš„é¢„ç®—å¯¹æ¯”åŠŸèƒ½ã€‚

è¯¥æ–¹æ¡ˆä¸ä»…è§£å†³äº†é¢„ç®—å¯¹æ¯”çš„æ ¸å¿ƒéœ€æ±‚ï¼Œè¿˜ä¿æŒäº†ç³»ç»Ÿæ•´ä½“åŠŸèƒ½æž¶æž„çš„ç®€æ´æ€§ï¼Œé¿å…äº†ä¸å¿…è¦çš„åŠŸèƒ½é‡å¤ï¼Œæ˜¯æœ€ç¬¦åˆäº§å“è®¾è®¡åŽŸåˆ™çš„é€‰æ‹©ã€‚