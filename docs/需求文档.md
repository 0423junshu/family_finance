# 家庭财务管理微信小程序需求文档

## 全局功能
- **显示/隐藏金额**：所有展示具体金额的页面在页面右上角显示"小眼睛"图标，点击后可隐藏或显示当前页面所有金额信息，保护用户隐私

## 1. 项目概述

### 1.1 项目背景
随着家庭理财意识的增强，人们对家庭财务管理工具的需求日益增长。传统的记账方式已经无法满足现代家庭对财务透明度、便捷性和数据分析的需求。因此，开发一款专注于家庭财务管理的微信小程序，可以帮助用户随时随地记录和管理家庭收支，提高家庭财务健康度。

### 1.2 项目目标
开发一款功能完善、操作简便的家庭财务管理微信小程序，帮助用户实现家庭收支记录、预算管理、财务分析和多成员协作管理等功能，提升家庭财务管理效率和透明度。

## 2. 功能需求

### 2.1 智能记账系统
1. **账单录入**
   - 场景：成员A打开"记一笔"页面，填写日期、金额、分类、标签、备注，可拍照上传票据
   - 校验：金额必填；分类必选；标签可选、多选；日期默认今日，可下拉选择
   - 保存后自动同步至家庭账本，其他在线成员可见并收到"新账单"提示
2. **实时协同**
   - 首页账本列表显示"同步中"/"已同步"状态
   - 新增/修改/删除账单时，生成实时提示气泡，点击可查看详情
3. **自定义记账周期**
   - 默认预设「本月」「本季度」「本年」，支持"自定义"日历范围
   - 自定义周期可保存为"常用周期"便于一键切换
4. **多级分类与标签**
   - 分类：支持三级分类（一级→二级→三级）管理
   - 标签：可在分类下添加或统一管理，录入时可多选标签
   - 在"记一笔"页面内可快速新增/编辑/删除分类和标签
5. **可视化报表**
   - 收支趋势图：折线图展示 12 个月收入/支出，可点击月度查看明细
   - 环形结构图：展示当前周期各一级分类占比，点击展开二三级分类
6. **银行交易同步**
   - "一键同步"按钮：执行后弹出同步状态提示，并展示新增账单数量
   - 同步记录列表：查看历史同步时间及结果，可手动确认或忽略

### 2.2 家庭资产总览
1. **资产负债仪表盘**
   - 头部汇总：总资产、总负债、净值（资产−负债）
   - 分类卡片：现金、房产、理财、负债等，点击查看成员分布明细
2. **PDF 年度报告**
   - 时间范围选择后，可预览年度净值曲线、收支摘要、资产分布
   - 支持下载、微信分享、发送邮箱
3. **资产热力图**
   - 维度切换：类型／成员／时间
   - X 轴：时间（月/季），Y 轴：资产类型或成员，颜色深浅表示金额大小
   - 长按/悬停查看具体数值

### 2.3 投资模拟功能
1. **证券持仓管理**
   - 列表页：展示名称、数量、成本价、市值、盈亏
   - 添加/编辑：选择市场（A股/港股/基金）、代码、数量、成本价
   - 删除需二次确认，避免误操作
2. **行情同步**
   - 列表顶部显示"最后更新"时间，支持手动刷新
   - 系统每日收盘后自动更新
3. **投资回报分析**
   - 分析页：总市值、总盈亏、年化收益率等汇总
   - 支持自定义周期图表（市值曲线、收益分布饼图）
   - 可导出图片分享

### 2.4 成员管理
1. **家庭组与邀请码**
   - Owner 创建家庭组并生成邀请码或邀请链接
   - 被邀请成员输入邀请码完成注册并加入家庭组
2. **权限模型**
   - Owner：全面管理
   - Admin：管理账本/资产/投资/分类，但不能变更Owner或删除家庭组
   - Member：新增/编辑自己录入的数据、查看报表，无删除他人数据权限
3. **冲突提示**
   - 同时编辑同一分类或账单时，弹出"冲突解决"对话框，展示不同版本并可选择合并

### 2.5 预算管理与提醒
1. **预算设置**
   - 按月/季/年为一级分类设置预算，支持三级分类或标签的子预算
   - 预算分组：合并多个分类为"出行预算""娱乐预算"
2. **实时提醒**
   - 消费达预算70%/90%时，弹出应用内提醒并推送微信通知
   - 预算页展示进度条及今日/本周/本月汇总
3. **超额规则**
   - 可选"超额止支"或"仅提醒"
   - "超额止支"模式下，新增账单时若超额会提示是否继续录入

### 2.6 财务目标与里程碑
1. **目标创建**
   - 填写目标名称、金额、开始/结束日期，关联分类
   - 支持自动攒钱规则（固定金额、按收入比例）
2. **里程碑展示**
   - 达到25%/50%/75%进度时，弹出庆祝动画和徽章
   - 列表显示完成百分比、剩余天数、操作日志
3. **目标调整**
   - 可修改目标金额或结束日期，保留历史变更记录

### 2.7 数据导入与导出
1. **数据导入**
   - CSV/Excel：从微信文件或邮箱导入账单
   - 第三方平台：一键导入支付宝、微信支付账单
2. **数据导出**
   - 支持 Excel、CSV、PDF 格式
   - 自定义日期范围或筛选后数据导出

### 2.8 智能分类与标签推荐
1. **AI 自动分类**
   - 根据历史相似账单推荐分类和标签
2. **标签云**
   - 在统计页面展示热门标签云，点击查看相关账单

### 2.9 应用导航与整体流程
1. **底部导航栏五项**
   - 首页（记账+账本预览）
   - 报表（趋势/环比/结构图）
   - 资产（仪表盘+热力图+目标）
   - 投资（持仓+分析）
   - 我的（家庭设置+成员管理+预算/目标/导入导出/帮助）
2. **新手引导**
   - 首次打开弹出三步引导：记账→查看报表→邀请成员
   - 隐藏功能提示气泡（如预算提醒、小窍门等）

### 2.10 隐私与安全声明
1. **数据所有权**
   - 用户数据归家庭组成员所有，不对外共享
2. **权限可见性**
   - 明确各角色可见和可操作的数据范围
3. **数据清理**
   - 提供"一键清空所有数据"和"导出并删除"功能

### 2.11 历史审计与回滚
1. **审计日志**
   - 记录所有账单/资产/持仓的增删改操作"谁在何时做了什么"
   - 审计页面按时间、成员、操作类型筛选查看
2. **数据回滚**
   - 对单笔账单或整份报表执行"撤销"或"恢复到某时间点"
   - 回滚操作需审批并留痕

### 2.12 智能财务助手
1. **问答式交互**
   - 自然语言提问（如"上个月餐饮花费多少？"），返回图文答案
2. **定期提醒**
   - 自定义推送频率（每日/每周/每月）关键数据摘要
3. **财务诊断**
   - 月度"家庭财务健康报告"，包含现金流平衡、资产配置建议

### 2.13 多场景共享与权限配置
1. **分账本模式**
   - 独立记账与报表的子账本，可单独授权给部分成员
2. **公/私账本切换**
   - 公账本全员可见，私账本仅自己可见，可随时转换并同步历史数据

### 2.14 多端体验与扩展
1. **微信小程序 + H5**
   - 小程序内核心功能，H5 版查看报表与导出数据
2. **桌面/平板视图**
   - 横屏排版、卡片拖拽布局
3. **第三方数据打通**
   - 支持导入会计软件、财税平台数据

### 2.15 设置与个性化
1. **主题与布局**
   - 浅/深色主题切换，全局生效
   - 首页卡片拖拽定制顺序
2. **语言与区域**
   - 切换中英文界面、数字格式
3. **通知偏好**
   - 按类型（预算、同步、助手）开启/关闭微信或内置通知

### 2.16 隐私合规与用户协议
1. **数据导出合规**
   - 导出前提醒"含有个人隐私信息"，需二次确认
2. **协议与隐私声明**
   - 在"关于"页展示《用户协议》《隐私政策》，关键操作前弹窗同意
3. **法规支持**
   - 提供"数据查询""数据删除"入口，满足用户对个人数据的管理权

## 3. 非功能需求

### 3.1 性能需求
- 页面加载时间不超过3秒
- 数据处理响应时间不超过2秒
- 支持同时100人以上的并发访问
- 离线记账功能，网络恢复后自动同步

### 3.2 安全需求
- 采用HTTPS协议保障数据传输安全
- 敏感数据加密存储
- 权限分级管理，确保数据访问安全
- 定期数据备份，防止数据丢失
- 支持指纹/面容解锁应用

### 3.3 可用性需求
- 界面设计简洁直观，操作流程不超过3步
- 提供详细的使用指南和帮助文档
- 支持离线记账，网络恢复后自动同步
- 适配深色模式，减少夜间使用时的视觉疲劳

### 3.4 兼容性需求
- 兼容微信最新版本及前两个主要版本
- 适配不同尺寸的移动设备屏幕
- 支持iOS和Android系统的微信环境

## 4. 技术要求

### 4.1 开发环境
- 微信开发者工具
- 小程序框架：原生框架
- 数据库：云开发数据库
- 图表库：ECharts或微信原生图表组件

### 4.2 接口要求
- 微信登录接口
- 微信支付接口（可选）
- 云开发数据库接口
- 微信订阅消息接口
- 微信分享接口
- 第三方金融数据API（股票、基金行情）

## 5. 项目规划

### 5.1 开发阶段
1. **需求分析与设计**：2周
2. **核心功能开发**：4周
   - 用户管理与家庭组
   - 智能记账系统
   - 账户与资产管理
3. **扩展功能开发**：4周
   - 预算管理与提醒
   - 财务分析与报表
   - 财务目标与里程碑
   - 投资模拟功能
4. **高级功能开发**：3周
   - 智能财务助手
   - 多场景共享与权限
   - 历史审计与回滚
5. **测试与优化**：2周
6. **上线准备**：1周

### 5.2 里程碑
1. **原型设计完成**：项目启动后2周
2. **核心功能开发完成**：项目启动后6周
3. **扩展功能开发完成**：项目启动后10周
4. **高级功能开发完成**：项目启动后13周
5. **测试完成**：项目启动后15周
6. **正式上线**：项目启动后16周

### 5.3 家庭协作功能开发与测试记录

#### 5.3.1 功能开发状态 ✅
**完成时间**: 2025年1月7日  
**开发内容**:
- ✅ 家庭创建与管理功能
- ✅ 成员邀请与权限控制
- ✅ 实时数据同步机制
- ✅ 协作状态管理
- ✅ 操作日志记录
- ✅ 冲突检测与解决

#### 5.3.2 测试执行记录 ✅
**测试时间**: 2025年1月7日 12:00  
**测试类型**: 快速测试（核心功能验证）  
**测试结果**: 
- 总测试数: 3个测试组
- 通过测试: 3个 (100%)
- 失败测试: 0个 (0%)
- 成功率: 100.00%

**测试覆盖范围**:
1. ✅ 我的页面功能入口测试
   - 未加入家庭状态显示
   - 已加入家庭状态显示
   - 按钮事件绑定测试

2. ✅ 家庭管理页面基础功能测试
   - 页面数据加载
   - 家庭码操作
   - 邀请功能

3. ✅ 页面跳转逻辑测试
   - 多个页面间的跳转验证
   - 返回功能测试

**相关文档**:
- 测试计划: `docs/家庭协作功能测试计划.md`
- 测试结果: `docs/家庭协作功能测试结果分析.md`
- 问题记录: `docs/家庭协作功能问题记录.md`

#### 5.3.3 待完善项目
**优先级P1 (严重问题)**:
- 🔄 时间戳计算异常修复
- 🔄 权限验证机制加强
- 🔄 并发操作冲突处理

**优先级P2 (一般问题)**:
- 🔄 错误处理测试补充
- 🔄 移动端适配验证
- 🔄 性能优化实施
- 🔄 边界条件测试

**下一步计划**:
1. 完整功能测试 (1-2天)
2. 性能优化实施 (1周)
3. 真实设备验证 (1周)
4. 用户体验测试 (1周)

## 6. 风险评估

### 6.1 技术风险
- 数据同步冲突处理
- 大量数据的性能优化
- 微信平台政策变更
- 多端数据一致性保障
- 第三方API稳定性

### 6.2 业务风险
- 用户隐私保护合规性
- 财务数据准确性保障
- 用户习惯培养与留存
- 竞品功能快速迭代
- 用户对AI功能的接受度

## 7. 验收标准

### 7.1 功能验收
- 所有功能需求实现并通过测试
- 用户界面符合设计规范
- 数据处理准确无误
- 各角色权限控制有效

### 7.2 性能验收
- 满足性能需求中的各项指标
- 稳定运行，无崩溃现象
- 数据备份与恢复功能可靠
- 离线功能正常工作

### 7.3 安全验收
- 通过安全测试，无明显安全漏洞
- 敏感数据加密存储验证
- 权限控制有效
- 数据传输加密有效
- 隐私保护措施完善

## 8. 附录

### 8.1 术语表
- **预算**：计划在特定时期内的收支限额
- **资产**：用户拥有的所有有价值的资源
- **负债**：用户所欠的债务
- **净资产**：资产减去负债后的余额
- **标签**：对交易记录的自定义标记，用于更细致的分类
- **里程碑**：财务目标达成的重要节点
- **热力图**：使用颜色深浅表示数值大小的可视化图表
- **审计日志**：记录系统中所有操作的详细记录

### 8.2 参考资料
- 微信小程序开发文档
- 云开发技术文档
- 相关法律法规和财务规范
- 《个人信息保护法》相关条款
